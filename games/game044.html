<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨ç†ã‚²ãƒ¼ãƒ  - ã‚²ãƒ¼ãƒ 044</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .game-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            max-width: 900px;
            width: 90%;
            text-align: center;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
            max-height: 85vh;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .game-title {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .game-description {
            font-size: 1.2rem;
            margin-bottom: 30px;
            opacity: 0.9;
        }

        .detective-game {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .case-info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            text-align: left;
        }

        .clues-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .clue-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .clue-card:hover {
            border-color: #FFD700;
            transform: translateY(-2px);
        }

        .clue-card.analyzed {
            border-color: #00FF00;
            background: rgba(0, 255, 0, 0.1);
        }

        .suspects-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .suspect-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .suspect-card:hover {
            border-color: #FFD700;
            transform: translateY(-2px);
        }

        .suspect-card.eliminated {
            opacity: 0.5;
            border-color: #FF0000;
        }

        .suspect-card.selected {
            border-color: #00FF00;
            background: rgba(0, 255, 0, 0.1);
        }

        .hypothesis-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .evidence-chain {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 15px 0;
        }

        .evidence-link {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 8px 15px;
            font-size: 0.9rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .game-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
        }

        .btn {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .game-stats {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            flex-wrap: wrap;
            gap: 15px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            min-width: 120px;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #FFD700;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00FF00, #FFD700);
            transition: width 0.3s ease;
        }

        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .instructions {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
            line-height: 1.6;
        }

        .instructions h3 {
            color: #FFD700;
            margin-bottom: 10px;
        }

        .instructions ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .instructions li {
            margin: 5px 0;
        }

        @media (max-width: 768px) {
            .game-container {
                width: 95%;
                padding: 20px;
                max-height: 90vh;
            }
            
            .game-title {
                font-size: 2rem;
            }
            
            .clues-section {
                grid-template-columns: 1fr;
            }
            
            .suspects-section {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <button class="back-btn" onclick="goBack()">â† ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>
    
    <div class="game-container">
        <h1 class="game-title">ğŸ•µï¸ æ¨ç†ã‚²ãƒ¼ãƒ </h1>
        <p class="game-description">æ‰‹ãŒã‹ã‚Šåˆ†æã¨ä»®èª¬æ¤œè¨¼ã«ã‚ˆã‚‹äº‹ä»¶è§£æ±ºå‹æ¨ç†èƒ½åŠ›ã‚²ãƒ¼ãƒ </p>

        <div class="instructions">
            <h3>ğŸ“‹ è©³ç´°ãƒ«ãƒ¼ãƒ«ãƒ»éŠã³æ–¹</h3>
            <p><strong>ğŸ¯ ç›®çš„:</strong> 12ã®æ‰‹ãŒã‹ã‚Šã‚’åˆ†æã—ã€äº‹ä»¶ã®çœŸç›¸ã‚’è§£æ˜ã›ã‚ˆ</p>
            
            <p><strong>ğŸ® ã‚²ãƒ¼ãƒ ã®æµã‚Œ:</strong></p>
            <ul>
                <li>äº‹ä»¶ã®æ¦‚è¦ã‚’ç¢ºèª</li>
                <li>æ‰‹ãŒã‹ã‚Šã‚’1ã¤ãšã¤åˆ†æï¼ˆã‚¯ãƒªãƒƒã‚¯ã—ã¦è©³ç´°ç¢ºèªï¼‰</li>
                <li>å®¹ç–‘è€…ã®è¡Œå‹•ãƒ»å‹•æ©Ÿãƒ»ã‚¢ãƒªãƒã‚¤ã‚’æ¤œè¨¼</li>
                <li>è¨¼æ‹ ã®è«–ç†çš„çµ„ã¿ç«‹ã¦ã‚’æ§‹ç¯‰</li>
                <li>æ¨ç†ã‚’æ§‹ç¯‰ã—ã¦çŠ¯äººã‚’ç‰¹å®š</li>
                <li>è§£æ±ºç‡90%ä»¥ä¸Šã§ã‚¯ãƒªã‚¢</li>
            </ul>
            
            <p><strong>â­ è©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ :</strong></p>
            <ul>
                <li>äº‹ä»¶è§£æ±ºç‡: æ­£ç¢ºãªçŠ¯äººç‰¹å®š</li>
                <li>æ¨ç†ç²¾åº¦: è«–ç†çš„ãªæ¨ç†éç¨‹</li>
                <li>è¨¼æ‹ æ´»ç”¨åº¦: æ‰‹ãŒã‹ã‚Šã®åŠ¹æœçš„æ´»ç”¨</li>
                <li>è«–ç†æ§‹ç¯‰åŠ›: ç­‹é“ç«‹ã£ãŸæ¨ç†</li>
            </ul>
            
            <p><strong>ğŸ” ãƒ—ãƒ¬ã‚¤ã®ã‚³ãƒ„:</strong></p>
            <ul>
                <li>å…¨ã¦ã®æ‰‹ãŒã‹ã‚Šã‚’å¿…ãšåˆ†æã™ã‚‹</li>
                <li>çŸ›ç›¾ã™ã‚‹è¨¼è¨€ã‚’è¦‹ã¤ã‘ã‚‹</li>
                <li>æ™‚ç³»åˆ—ã‚’æ•´ç†ã—ã¦è¡Œå‹•ã‚’ç¢ºèª</li>
                <li>å‹•æ©Ÿã¨ã‚¢ãƒªãƒã‚¤ã®ä¸¡æ–¹ã‚’æ¤œè¨¼</li>
            </ul>
        </div>

        <div class="detective-game">
            <div class="case-info">
                <h3>ğŸ“„ äº‹ä»¶æ¦‚è¦</h3>
                <p id="case-description">é«˜ç´šã‚ªãƒ•ã‚£ã‚¹ãƒ“ãƒ«ã®ä¼šè­°å®¤ã§ä¼æ¥­ç§˜å¯†ãŒç›—ã¾ã‚ŒãŸã€‚å®¹ç–‘è€…ã¯3åã€‚æ‰‹ãŒã‹ã‚Šã‚’åˆ†æã—ã¦çœŸçŠ¯äººã‚’è¦‹ã¤ã‘ã‚ˆã†ã€‚</p>
                <p><strong>æ™‚åˆ»:</strong> <span id="crime-time">åˆå¾Œ8æ™‚30åˆ†</span></p>
                <p><strong>å ´æ‰€:</strong> <span id="crime-location">15éšä¼šè­°å®¤</span></p>
            </div>

            <div class="game-stats">
                <div class="stat-item">
                    <div class="stat-value" id="analyzed-clues">0</div>
                    <div class="stat-label">åˆ†ææ¸ˆã¿æ‰‹ãŒã‹ã‚Š</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="solution-progress">0</div>
                    <div class="stat-label">è§£æ±ºé€²æ—(%)</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="accuracy-score">100</div>
                    <div class="stat-label">æ¨ç†ç²¾åº¦(%)</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="time-remaining">300</div>
                    <div class="stat-label">æ®‹ã‚Šæ™‚é–“(ç§’)</div>
                </div>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progress-bar" style="width: 0%"></div>
            </div>

            <h3>ğŸ” æ‰‹ãŒã‹ã‚Šä¸€è¦§</h3>
            <div class="clues-section" id="clues-container">
                <!-- æ‰‹ãŒã‹ã‚Šã‚«ãƒ¼ãƒ‰ãŒJavaScriptã§ç”Ÿæˆã•ã‚Œã‚‹ -->
            </div>

            <h3>ğŸ‘¥ å®¹ç–‘è€…ä¸€è¦§</h3>
            <div class="suspects-section" id="suspects-container">
                <!-- å®¹ç–‘è€…ã‚«ãƒ¼ãƒ‰ãŒJavaScriptã§ç”Ÿæˆã•ã‚Œã‚‹ -->
            </div>

            <div class="hypothesis-section">
                <h3>ğŸ§  æ¨ç†æ§‹ç¯‰</h3>
                <p>é¸æŠã—ãŸè¨¼æ‹ :</p>
                <div class="evidence-chain" id="evidence-chain">
                    <!-- é¸æŠã•ã‚ŒãŸè¨¼æ‹ ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                </div>
                <textarea id="hypothesis-text" placeholder="ã‚ãªãŸã®æ¨ç†ã‚’è¨˜è¿°ã—ã¦ãã ã•ã„..." 
                         style="width: 100%; height: 100px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); border-radius: 10px; padding: 10px; color: white; resize: vertical;"></textarea>
            </div>

            <div class="game-controls">
                <button class="btn" onclick="startGame()" id="start-btn">ã‚²ãƒ¼ãƒ é–‹å§‹</button>
                <button class="btn" onclick="analyzeClue()" id="analyze-btn" disabled>æ‰‹ãŒã‹ã‚Šåˆ†æ</button>
                <button class="btn" onclick="eliminateSuspect()" id="eliminate-btn" disabled>å®¹ç–‘è€…é™¤å¤–</button>
                <button class="btn" onclick="buildHypothesis()" id="hypothesis-btn" disabled>æ¨ç†æ§‹ç¯‰</button>
                <button class="btn" onclick="solveCase()" id="solve-btn" disabled>äº‹ä»¶è§£æ±º</button>
                <button class="btn" onclick="resetGame()" id="reset-btn">ãƒªã‚»ãƒƒãƒˆ</button>
            </div>
        </div>
    </div>

    <script>
        let gameState = {
            isPlaying: false,
            timeRemaining: 300,
            analyzedClues: 0,
            selectedClues: [],
            selectedSuspect: null,
            eliminatedSuspects: [],
            solutionProgress: 0,
            accuracyScore: 100,
            timer: null,
            correctSuspect: 1, // ç”°ä¸­ãŒçŠ¯äºº
            cluesData: [
                {id: 1, title: "ç›£è¦–ã‚«ãƒ¡ãƒ©æ˜ åƒ", content: "åˆå¾Œ8æ™‚25åˆ†ã€ç”°ä¸­ãŒä¼šè­°å®¤ã«å‘ã‹ã†å§¿", importance: 9},
                {id: 2, title: "ã‚¢ã‚¯ã‚»ã‚¹ã‚«ãƒ¼ãƒ‰è¨˜éŒ²", content: "ç”°ä¸­ã®ã‚«ãƒ¼ãƒ‰ã§8æ™‚28åˆ†ã«ä¼šè­°å®¤å…¥å®¤", importance: 10},
                {id: 3, title: "æŒ‡ç´‹é‘‘å®š", content: "é‡‘åº«ã‹ã‚‰ç”°ä¸­ã®æŒ‡ç´‹ã‚’æ¤œå‡º", importance: 10},
                {id: 4, title: "ä½è—¤ã®è¨¼è¨€", content: "8æ™‚30åˆ†é ƒã€å»Šä¸‹ã§ç”°ä¸­ã‚’è¦‹ã‹ã‘ãŸ", importance: 8},
                {id: 5, title: "éˆ´æœ¨ã®ã‚¢ãƒªãƒã‚¤", content: "8æ™‚20åˆ†ã€œ9æ™‚ã¾ã§åˆ¥ã®ä¼šè­°ã«å‚åŠ ", importance: 7},
                {id: 6, title: "ç”°ä¸­ã®å‹•æ©Ÿ", content: "æ˜‡é€²ã‚’é€ƒã—ã€ä¼šç¤¾ã«ä¸æº€ã‚’æŒã£ã¦ã„ãŸ", importance: 9},
                {id: 7, title: "å‰Šé™¤ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«", content: "ç”°ä¸­ã®PCã‹ã‚‰æ©Ÿå¯†ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒ”ãƒ¼ç—•è·¡", importance: 10},
                {id: 8, title: "æ¸…æƒå“¡ã®è¨¼è¨€", content: "8æ™‚35åˆ†ã€ç”°ä¸­ãŒæ…Œã¦ã¦å‡ºã¦ãã‚‹ã®ã‚’ç›®æ’ƒ", importance: 8},
                {id: 9, title: "USBãƒ¡ãƒ¢ãƒª", content: "ç”°ä¸­ã®ãƒ‡ã‚¹ã‚¯ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿è»¢é€ç”¨USBç™ºè¦‹", importance: 9},
                {id: 10, title: "é›»è©±è¨˜éŒ²", content: "8æ™‚15åˆ†ã€ç”°ä¸­ãŒç«¶åˆä»–ç¤¾ã«é›»è©±", importance: 8},
                {id: 11, title: "ä½è—¤ã®ã‚¢ãƒªãƒã‚¤", content: "8æ™‚ã€œ9æ™‚ã¾ã§å®¶æ—ã¨é£Ÿäº‹", importance: 6},
                {id: 12, title: "ä¼šè­°å®¤ã®çŠ¶æ³", content: "é‡‘åº«ãŒé–‹ã‘ã‚‰ã‚Œã€æ›¸é¡ãŒæ•£ä¹±", importance: 7}
            ],
            suspectsData: [
                {id: 1, name: "ç”°ä¸­", age: 45, position: "å–¶æ¥­éƒ¨é•·", motive: "æ˜‡é€²å¤±æ•—ã¸ã®ä¸æº€", alibi: "ä¸ååˆ†"},
                {id: 2, name: "ä½è—¤", age: 38, position: "æŠ€è¡“ä¸»ä»»", motive: "ç‰¹ã«ãªã—", alibi: "è¤‡æ•°ã®è¨¼è¨€ã‚ã‚Š"},
                {id: 3, name: "éˆ´æœ¨", age: 42, position: "ä¼ç”»èª²é•·", motive: "ç‰¹ã«ãªã—", alibi: "ä¼šè­°å‚åŠ è¨˜éŒ²ã‚ã‚Š"}
            ]
        };

        function startGame() {
            gameState.isPlaying = true;
            gameState.timeRemaining = 300;
            gameState.analyzedClues = 0;
            gameState.selectedClues = [];
            gameState.selectedSuspect = null;
            gameState.eliminatedSuspects = [];
            gameState.solutionProgress = 0;
            gameState.accuracyScore = 100;

            document.getElementById('start-btn').disabled = true;
            document.getElementById('analyze-btn').disabled = false;
            document.getElementById('reset-btn').disabled = false;

            generateClues();
            generateSuspects();
            startTimer();
            updateDisplay();
        }

        function generateClues() {
            const container = document.getElementById('clues-container');
            container.innerHTML = '';

            gameState.cluesData.forEach(clue => {
                const clueCard = document.createElement('div');
                clueCard.className = 'clue-card';
                clueCard.dataset.clueId = clue.id;
                clueCard.innerHTML = `
                    <h4>${clue.title}</h4>
                    <p>é‡è¦åº¦: ${'â˜…'.repeat(Math.floor(clue.importance/2))}</p>
                    <p class="clue-preview">ã‚¯ãƒªãƒƒã‚¯ã—ã¦è©³ç´°ã‚’ç¢ºèª</p>
                `;
                clueCard.onclick = () => selectClue(clue.id);
                container.appendChild(clueCard);
            });
        }

        function generateSuspects() {
            const container = document.getElementById('suspects-container');
            container.innerHTML = '';

            gameState.suspectsData.forEach(suspect => {
                const suspectCard = document.createElement('div');
                suspectCard.className = 'suspect-card';
                suspectCard.dataset.suspectId = suspect.id;
                suspectCard.innerHTML = `
                    <h4>${suspect.name} (${suspect.age}æ­³)</h4>
                    <p><strong>å½¹è·:</strong> ${suspect.position}</p>
                    <p><strong>å‹•æ©Ÿ:</strong> ${suspect.motive}</p>
                    <p><strong>ã‚¢ãƒªãƒã‚¤:</strong> ${suspect.alibi}</p>
                `;
                suspectCard.onclick = () => selectSuspect(suspect.id);
                container.appendChild(suspectCard);
            });
        }

        function selectClue(clueId) {
            if (!gameState.isPlaying) return;

            const clue = gameState.cluesData.find(c => c.id === clueId);
            const clueCard = document.querySelector(`[data-clue-id="${clueId}"]`);
            
            if (!gameState.selectedClues.includes(clueId)) {
                gameState.selectedClues.push(clueId);
                clueCard.classList.add('analyzed');
                
                // è©³ç´°å†…å®¹ã‚’è¡¨ç¤º
                const preview = clueCard.querySelector('.clue-preview');
                preview.textContent = clue.content;
                preview.style.fontWeight = 'bold';
                preview.style.color = '#FFD700';

                gameState.analyzedClues++;
                gameState.solutionProgress = Math.floor((gameState.analyzedClues / 12) * 60);
                
                updateEvidenceChain();
                updateDisplay();
                checkGameProgress();
            }
        }

        function selectSuspect(suspectId) {
            if (!gameState.isPlaying) return;

            // å‰å›ã®é¸æŠã‚’ã‚¯ãƒªã‚¢
            document.querySelectorAll('.suspect-card').forEach(card => {
                card.classList.remove('selected');
            });

            // æ–°ã—ã„é¸æŠã‚’é©ç”¨
            const suspectCard = document.querySelector(`[data-suspect-id="${suspectId}"]`);
            suspectCard.classList.add('selected');
            gameState.selectedSuspect = suspectId;

            document.getElementById('eliminate-btn').disabled = false;
            document.getElementById('hypothesis-btn').disabled = false;
        }

        function analyzeClue() {
            if (!gameState.isPlaying) return;
            alert('æ‰‹ãŒã‹ã‚Šã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦åˆ†æã—ã¦ãã ã•ã„');
        }

        function eliminateSuspect() {
            if (!gameState.selectedSuspect || !gameState.isPlaying) return;

            const suspectId = gameState.selectedSuspect;
            if (!gameState.eliminatedSuspects.includes(suspectId)) {
                gameState.eliminatedSuspects.push(suspectId);
                const suspectCard = document.querySelector(`[data-suspect-id="${suspectId}"]`);
                suspectCard.classList.add('eliminated');
                suspectCard.classList.remove('selected');
                
                // æ­£ã—ã„å®¹ç–‘è€…ã‚’é™¤å¤–ã—ãŸå ´åˆã¯ç²¾åº¦ã‚’ä¸‹ã’ã‚‹
                if (suspectId === gameState.correctSuspect) {
                    gameState.accuracyScore -= 30;
                }
                
                gameState.selectedSuspect = null;
                document.getElementById('eliminate-btn').disabled = true;
                updateDisplay();
            }
        }

        function buildHypothesis() {
            if (!gameState.selectedSuspect || !gameState.isPlaying) return;
            
            const hypothesisText = document.getElementById('hypothesis-text').value;
            if (hypothesisText.length < 50) {
                alert('æ¨ç†ã‚’ã‚ˆã‚Šè©³ã—ãè¨˜è¿°ã—ã¦ãã ã•ã„ï¼ˆ50æ–‡å­—ä»¥ä¸Šï¼‰');
                return;
            }

            gameState.solutionProgress = Math.max(gameState.solutionProgress, 80);
            document.getElementById('solve-btn').disabled = false;
            updateDisplay();
        }

        function updateEvidenceChain() {
            const container = document.getElementById('evidence-chain');
            container.innerHTML = '';

            gameState.selectedClues.forEach(clueId => {
                const clue = gameState.cluesData.find(c => c.id === clueId);
                const evidenceLink = document.createElement('div');
                evidenceLink.className = 'evidence-link';
                evidenceLink.textContent = clue.title;
                container.appendChild(evidenceLink);
            });
        }

        function solveCase() {
            if (!gameState.selectedSuspect || !gameState.isPlaying) {
                alert('çŠ¯äººã‚’é¸æŠã—ã€æ¨ç†ã‚’æ§‹ç¯‰ã—ã¦ãã ã•ã„');
                return;
            }

            gameState.isPlaying = false;
            clearInterval(gameState.timer);

            const isCorrect = gameState.selectedSuspect === gameState.correctSuspect;
            const hypothesisQuality = document.getElementById('hypothesis-text').value.length;
            
            let finalScore = gameState.accuracyScore;
            
            if (isCorrect) {
                finalScore += 20;
                gameState.solutionProgress = 100;
            } else {
                finalScore -= 40;
            }

            // æ¨ç†ã®è³ªã«ã‚ˆã‚‹åŠ ç‚¹
            if (hypothesisQuality > 100) finalScore += 10;

            // æ™‚é–“ãƒœãƒ¼ãƒŠã‚¹
            if (gameState.timeRemaining > 120) finalScore += 10;

            const resultMessage = isCorrect ? 
                `ğŸ‰ äº‹ä»¶è§£æ±ºæˆåŠŸï¼\n\næ­£è§£: ${gameState.suspectsData[0].name}ãŒçŠ¯äººã§ã—ãŸ\n\næœ€çµ‚ã‚¹ã‚³ã‚¢: ${finalScore}%\n${finalScore >= 90 ? 'ã‚¨ã‚¯ã‚»ãƒ¬ãƒ³ãƒˆï¼å„ªç§€ãªæ¨ç†åŠ›ã§ã™ï¼' : finalScore >= 70 ? 'ã‚°ãƒƒãƒ‰ï¼è‰¯ã„æ¨ç†ã§ã—ãŸï¼' : 'ã‚‚ã†å°‘ã—æ…é‡ã«åˆ†æã—ã¾ã—ã‚‡ã†'}` :
                `âŒ æ¨ç†ãŒå¤–ã‚Œã¾ã—ãŸ\n\næ­£è§£: ${gameState.suspectsData[0].name}ãŒçŠ¯äººã§ã—ãŸ\næ‰‹ãŒã‹ã‚Šã‚’ã‚ˆã‚Šæ…é‡ã«åˆ†æã—ã¾ã—ã‚‡ã†\n\næœ€çµ‚ã‚¹ã‚³ã‚¢: ${finalScore}%`;

            alert(resultMessage);
            
            gameState.accuracyScore = Math.max(0, finalScore);
            updateDisplay();

            // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('start-btn').disabled = false;
            document.getElementById('solve-btn').disabled = true;
            document.getElementById('analyze-btn').disabled = true;
            document.getElementById('eliminate-btn').disabled = true;
            document.getElementById('hypothesis-btn').disabled = true;
        }

        function checkGameProgress() {
            // å…¨ã¦ã®æ‰‹ãŒã‹ã‚Šã‚’åˆ†æã—ãŸå ´åˆ
            if (gameState.analyzedClues >= 8) {
                document.getElementById('hypothesis-btn').disabled = false;
            }
        }

        function startTimer() {
            gameState.timer = setInterval(() => {
                gameState.timeRemaining--;
                updateDisplay();

                if (gameState.timeRemaining <= 0) {
                    gameState.isPlaying = false;
                    clearInterval(gameState.timer);
                    alert('æ™‚é–“åˆ‡ã‚Œã§ã™ï¼äº‹ä»¶ã¯æœªè§£æ±ºã«çµ‚ã‚ã‚Šã¾ã—ãŸ...');
                    
                    // ã‚²ãƒ¼ãƒ çµ‚äº†å‡¦ç†
                    document.getElementById('start-btn').disabled = false;
                    document.getElementById('solve-btn').disabled = true;
                    document.getElementById('analyze-btn').disabled = true;
                    document.getElementById('eliminate-btn').disabled = true;
                    document.getElementById('hypothesis-btn').disabled = true;
                }
            }, 1000);
        }

        function updateDisplay() {
            document.getElementById('analyzed-clues').textContent = gameState.analyzedClues;
            document.getElementById('solution-progress').textContent = gameState.solutionProgress;
            document.getElementById('accuracy-score').textContent = Math.max(0, gameState.accuracyScore);
            document.getElementById('time-remaining').textContent = gameState.timeRemaining;
            document.getElementById('progress-bar').style.width = gameState.solutionProgress + '%';
        }

        function resetGame() {
            gameState.isPlaying = false;
            if (gameState.timer) {
                clearInterval(gameState.timer);
            }

            gameState.timeRemaining = 300;
            gameState.analyzedClues = 0;
            gameState.selectedClues = [];
            gameState.selectedSuspect = null;
            gameState.eliminatedSuspects = [];
            gameState.solutionProgress = 0;
            gameState.accuracyScore = 100;

            document.getElementById('hypothesis-text').value = '';
            document.getElementById('evidence-chain').innerHTML = '';
            document.getElementById('clues-container').innerHTML = '';
            document.getElementById('suspects-container').innerHTML = '';

            // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('start-btn').disabled = false;
            document.getElementById('analyze-btn').disabled = true;
            document.getElementById('eliminate-btn').disabled = true;
            document.getElementById('hypothesis-btn').disabled = true;
            document.getElementById('solve-btn').disabled = true;
            document.getElementById('reset-btn').disabled = false;

            updateDisplay();
        }

        function goBack() {
            if (gameState.isPlaying) {
                if (confirm('ã‚²ãƒ¼ãƒ ä¸­ã§ã™ã€‚æœ¬å½“ã«æˆ»ã‚Šã¾ã™ã‹ï¼Ÿ')) {
                    window.location.href = '../index.html';
                }
            } else {
                window.location.href = '../index.html';
            }
        }

        // åˆæœŸåŒ–
        updateDisplay();
</script>
</body>
</html>