<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‘ãƒ¼ã‚¹ãƒšã‚¯ãƒ†ã‚£ãƒ– - ã‚²ãƒ¼ãƒ 069</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .game-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            max-width: 800px;
            width: 90%;
            text-align: center;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
            max-height: 85vh;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .game-title {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .game-description {
            font-size: 1.2rem;
            margin-bottom: 30px;
            opacity: 0.9;
        }

        .game-stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .stat {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px 25px;
            border-radius: 15px;
            min-width: 100px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
        }

        .game-area {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 40px;
            margin-bottom: 30px;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .perspective-area {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 100%;
        }

        .perspective-viewport {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }

        .perspective-viewport h4 {
            color: #ffc107;
            margin-bottom: 15px;
        }

        .perspective-controls {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 15px;
        }

        .perspective-controls h4 {
            color: #ffc107;
            margin-bottom: 10px;
            text-align: center;
        }

        .viewpoint-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .viewpoint-btn {
            background: rgba(255, 255, 255, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.5);
            color: white;
            padding: 12px 16px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            text-align: center;
        }

        .viewpoint-btn:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: translateY(-2px);
        }

        .viewpoint-btn.active {
            background: rgba(255, 193, 7, 0.7);
            border-color: #ffc107;
        }

        .perspective-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
        }

        .info-panels {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            text-align: center;
        }

        .info-panel {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .depth-slider {
            width: 100%;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            height: 8px;
            outline: none;
            appearance: none;
        }

        .depth-slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ffc107;
            cursor: pointer;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .instructions {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: left;
            flex-shrink: 0;
        }

        .instructions h4 {
            color: #ffc107;
            margin-bottom: 10px;
        }

        .instructions ul {
            margin-left: 20px;
        }

        .instructions li {
            margin: 5px 0;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            margin: 15px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        @media (max-width: 768px) {
            .viewpoint-controls {
                grid-template-columns: repeat(2, 1fr);
            }
            .info-panels {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <button class="back-btn" onclick="goBack()">â† ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>

    <div class="game-container">
        <h1 class="game-title">ğŸ” ãƒ‘ãƒ¼ã‚¹ãƒšã‚¯ãƒ†ã‚£ãƒ–</h1>
        <p class="game-description">è¦–ç‚¹å¤‰æ›ã¨é è¿‘æ³•ç†è§£ã«ã‚ˆã‚‹ç©ºé–“èªè­˜æ·±åº¦ç†è§£ã‚²ãƒ¼ãƒ </p>

        <div class="game-stats">
            <div class="stat">
                <div class="stat-label">å¤‰æ›æ•°</div>
                <div class="stat-value" id="currentTransform">1</div>
            </div>
            <div class="stat">
                <div class="stat-label">ç†è§£æ•°</div>
                <div class="stat-value" id="understoodCount">0</div>
            </div>
            <div class="stat">
                <div class="stat-label">ç†è§£åº¦</div>
                <div class="stat-value" id="understandingRate">0%</div>
            </div>
            <div class="stat">
                <div class="stat-label">ã‚¹ã‚³ã‚¢</div>
                <div class="stat-value" id="score">0</div>
            </div>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="instructions">
            <h4>ğŸ“‹ è©³ç´°ãƒ«ãƒ¼ãƒ«ãƒ»éŠã³æ–¹</h4>
            <ul>
                <li><strong>ç›®çš„:</strong> 12ç¨®é¡ã®è¦–ç‚¹å¤‰æ›ã‚’ç†è§£ã—ã€é è¿‘æ³•ã¨æ·±åº¦æƒ…å ±ã‚’æ­£ç¢ºã«æŠŠæ¡ã™ã‚‹</li>
                <li><strong>ã‚²ãƒ¼ãƒ ã®æµã‚Œ:</strong>
                    <ul>
                        <li>3Dç‰©ä½“ã®ç•°ãªã‚‹è¦–ç‚¹ã‹ã‚‰ã®è¦‹ãˆæ–¹ã‚’å­¦ç¿’ã™ã‚‹</li>
                        <li>ãƒ‘ãƒ¼ã‚¹ãƒšã‚¯ãƒ†ã‚£ãƒ–ï¼ˆé è¿‘æ³•ï¼‰ã®åŠ¹æœã‚’ä½“é¨“ã™ã‚‹</li>
                        <li>æ·±åº¦ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§å¥¥è¡Œãã®å¤‰åŒ–ã‚’ç¢ºèªã™ã‚‹</li>
                    </ul>
                </li>
                <li><strong>è¦–ç‚¹æ“ä½œ:</strong> ä¸Šé¢ãƒ»æ­£é¢ãƒ»å´é¢ãƒ»æ–œã‚è¦–ç‚¹ãªã©12ç¨®é¡ã®è¦–ç‚¹ãƒœã‚¿ãƒ³</li>
                <li><strong>å‹åˆ©æ¡ä»¶:</strong> 12å¤‰æ›ä¸­ã€ç†è§£åº¦90%ä»¥ä¸Šï¼ˆ11å¤‰æ›ä»¥ä¸Šç†è§£ï¼‰ã§ã‚¯ãƒªã‚¢</li>
                <li><strong>è©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ :</strong> æ­£ç¢ºãªç†è§£: +100ç‚¹ã€æ·±åº¦èªè­˜: +50ç‚¹ã€èª¤ç†è§£: -25ç‚¹</li>
                <li><strong>ãƒ—ãƒ¬ã‚¤ã®ã‚³ãƒ„:</strong> ç‰©ä½“ã®3æ¬¡å…ƒçš„ãªå½¢çŠ¶ã¨è¦–ç‚¹ã®é–¢ä¿‚æ€§ã‚’æ„è­˜ã™ã‚‹</li>
            </ul>
        </div>

        <div class="game-area">
            <div class="perspective-area" id="perspectiveArea">
                <div class="perspective-viewport">
                    <h4>ğŸ¯ 3Dç‰©ä½“è¡¨ç¤º</h4>
                    <canvas id="perspectiveCanvas" width="600" height="400" style="border: 2px solid #fff; border-radius: 10px; background: rgba(0,0,0,0.8);"></canvas>
                </div>
                
                <div class="perspective-controls">
                    <h4>ğŸ‘ï¸ è¦–ç‚¹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«</h4>
                    <div class="viewpoint-controls" id="viewpointControls">
                        <button class="viewpoint-btn" onclick="changeViewpoint('top')">ä¸Šé¢è¦–ç‚¹</button>
                        <button class="viewpoint-btn" onclick="changeViewpoint('front')">æ­£é¢è¦–ç‚¹</button>
                        <button class="viewpoint-btn" onclick="changeViewpoint('side')">å´é¢è¦–ç‚¹</button>
                        <button class="viewpoint-btn" onclick="changeViewpoint('diagonal')">æ–œã‚è¦–ç‚¹</button>
                        <button class="viewpoint-btn" onclick="changeViewpoint('bottom')">åº•é¢è¦–ç‚¹</button>
                        <button class="viewpoint-btn" onclick="changeViewpoint('back')">èƒŒé¢è¦–ç‚¹</button>
                        <button class="viewpoint-btn" onclick="changeViewpoint('left')">å·¦è¦–ç‚¹</button>
                        <button class="viewpoint-btn" onclick="changeViewpoint('right')">å³è¦–ç‚¹</button>
                        <button class="viewpoint-btn" onclick="changeViewpoint('bird')">é³¥ç°è¦–ç‚¹</button>
                        <button class="viewpoint-btn" onclick="changeViewpoint('worm')">è™«ç°è¦–ç‚¹</button>
                        <button class="viewpoint-btn" onclick="changeViewpoint('perspective')">é è¿‘è¦–ç‚¹</button>
                        <button class="viewpoint-btn" onclick="changeViewpoint('isometric')">ç­‰è§’è¦–ç‚¹</button>
                    </div>
                    
                    <div style="margin-top: 15px;">
                        <label style="color: #ffc107; font-weight: bold;">æ·±åº¦èª¿æ•´:</label>
                        <input type="range" class="depth-slider" id="depthSlider" min="1" max="10" value="5" 
                               oninput="adjustDepth(this.value)">
                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem; margin-top: 5px;">
                            <span>è¿‘</span>
                            <span>ä¸­</span>
                            <span>é </span>
                        </div>
                    </div>
                </div>
                
                <div class="perspective-info">
                    <div class="info-panels">
                        <div class="info-panel">
                            <strong>ç¾åœ¨ã®è¦–ç‚¹:</strong><br>
                            <span id="currentViewpoint">æ­£é¢è¦–ç‚¹</span>
                        </div>
                        <div class="info-panel">
                            <strong>æ·±åº¦ãƒ¬ãƒ™ãƒ«:</strong><br>
                            <span id="depthLevel">5</span>
                        </div>
                        <div class="info-panel">
                            <strong>é è¿‘åŠ¹æœ:</strong><br>
                            <span id="perspectiveEffect">ä¸­ç¨‹åº¦</span>
                        </div>
                        <div class="info-panel">
                            <strong>ç†è§£çŠ¶æ³:</strong><br>
                            <span id="understandingStatus">å­¦ç¿’ä¸­</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="controls">
            <button class="btn" onclick="newPerspectiveChallenge()">æ–°ã—ã„ç‰©ä½“</button>
            <button class="btn" onclick="checkUnderstanding()">ç†è§£åº¦ãƒã‚§ãƒƒã‚¯</button>
            <button class="btn" onclick="showPerspectiveGuide()">é è¿‘æ³•ã‚¬ã‚¤ãƒ‰</button>
            <button class="btn" onclick="resetPerspective()">ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
    </div>

    <script>
        let gameState = {
            currentTransform: 1,
            totalTransforms: 12,
            understoodCount: 0,
            score: 0,
            currentViewpoint: 'front',
            currentDepth: 5,
            currentObject: null,
            canvas: null,
            ctx: null,
            viewpoints: ['top', 'front', 'side', 'diagonal', 'bottom', 'back', 'left', 'right', 'bird', 'worm', 'perspective', 'isometric']
        };

        const objects3D = [
            { name: 'ç«‹æ–¹ä½“', type: 'cube', complexity: 'easy' },
            { name: 'çƒä½“', type: 'sphere', complexity: 'easy' },
            { name: 'å††æŸ±', type: 'cylinder', complexity: 'normal' },
            { name: 'éŒä½“', type: 'cone', complexity: 'normal' },
            { name: 'Lå­—å‹', type: 'l-shape', complexity: 'hard' },
            { name: 'éšæ®µå‹', type: 'stairs', complexity: 'hard' },
            { name: 'å»ºç‰©å‹', type: 'building', complexity: 'expert' },
            { name: 'è¤‡åˆå‹', type: 'complex', complexity: 'expert' }
        ];

        function initializeGame() {
            gameState.canvas = document.getElementById('perspectiveCanvas');
            gameState.ctx = gameState.canvas.getContext('2d');
            
            resetGameState();
            generateNewObject();
            updateDisplay();
            drawPerspective();
        }

        function resetGameState() {
            gameState = {
                currentTransform: 1,
                totalTransforms: 12,
                understoodCount: 0,
                score: 0,
                currentViewpoint: 'front',
                currentDepth: 5,
                currentObject: null,
                canvas: gameState.canvas,
                ctx: gameState.ctx,
                viewpoints: ['top', 'front', 'side', 'diagonal', 'bottom', 'back', 'left', 'right', 'bird', 'worm', 'perspective', 'isometric']
            };
        }

        function generateNewObject() {
            if (gameState.currentTransform > gameState.totalTransforms) {
                endGame();
                return;
            }
            
            const objectIndex = (gameState.currentTransform - 1) % objects3D.length;
            gameState.currentObject = objects3D[objectIndex];
            
            // ãƒ©ãƒ³ãƒ€ãƒ ãªåˆæœŸè¦–ç‚¹
            gameState.currentViewpoint = gameState.viewpoints[Math.floor(Math.random() * gameState.viewpoints.length)];
            gameState.currentDepth = 3 + Math.floor(Math.random() * 5); // 3-7ã®ç¯„å›²
            
            updateViewpointDisplay();
            drawPerspective();
        }

        function changeViewpoint(viewpoint) {
            gameState.currentViewpoint = viewpoint;
            
            // å…¨ã¦ã®ãƒœã‚¿ãƒ³ã‹ã‚‰activeã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
            document.querySelectorAll('.viewpoint-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸãƒœã‚¿ãƒ³ã«activeã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
            event.target.classList.add('active');
            
            updateViewpointDisplay();
            drawPerspective();
        }

        function adjustDepth(depth) {
            gameState.currentDepth = parseInt(depth);
            document.getElementById('depthLevel').textContent = depth;
            
            const effects = ['æœ€å°', 'æ¥µå°', 'å°', 'ã‚„ã‚„å°', 'ä¸­ç¨‹åº¦', 'ã‚„ã‚„å¤§', 'å¤§', 'æ¥µå¤§', 'æœ€å¤§', 'è¶…å¤§'];
            document.getElementById('perspectiveEffect').textContent = effects[Math.min(depth - 1, effects.length - 1)];
            
            drawPerspective();
        }

        function updateViewpointDisplay() {
            const viewpointNames = {
                'top': 'ä¸Šé¢è¦–ç‚¹', 'front': 'æ­£é¢è¦–ç‚¹', 'side': 'å´é¢è¦–ç‚¹', 'diagonal': 'æ–œã‚è¦–ç‚¹',
                'bottom': 'åº•é¢è¦–ç‚¹', 'back': 'èƒŒé¢è¦–ç‚¹', 'left': 'å·¦è¦–ç‚¹', 'right': 'å³è¦–ç‚¹',
                'bird': 'é³¥ç°è¦–ç‚¹', 'worm': 'è™«ç°è¦–ç‚¹', 'perspective': 'é è¿‘è¦–ç‚¹', 'isometric': 'ç­‰è§’è¦–ç‚¹'
            };
            
            document.getElementById('currentViewpoint').textContent = viewpointNames[gameState.currentViewpoint] || gameState.currentViewpoint;
            document.getElementById('depthLevel').textContent = gameState.currentDepth;
        }

        function drawPerspective() {
            gameState.ctx.clearRect(0, 0, gameState.canvas.width, gameState.canvas.height);
            
            // é»’èƒŒæ™¯
            gameState.ctx.fillStyle = 'rgba(0, 0, 0, 0.9)';
            gameState.ctx.fillRect(0, 0, gameState.canvas.width, gameState.canvas.height);
            
            const centerX = gameState.canvas.width / 2;
            const centerY = gameState.canvas.height / 2;
            const scale = 80 + gameState.currentDepth * 10;
            
            // ã‚°ãƒªãƒƒãƒ‰è¡¨ç¤º
            drawGrid(centerX, centerY);
            
            // 3Dç‰©ä½“ã®æç”»
            if (gameState.currentObject) {
                switch (gameState.currentObject.type) {
                    case 'cube':
                        drawCubePerspective(centerX, centerY, scale);
                        break;
                    case 'sphere':
                        drawSpherePerspective(centerX, centerY, scale);
                        break;
                    case 'cylinder':
                        drawCylinderPerspective(centerX, centerY, scale);
                        break;
                    case 'cone':
                        drawConePerspective(centerX, centerY, scale);
                        break;
                    default:
                        drawCubePerspective(centerX, centerY, scale);
                }
            }
            
            // è¦–ç‚¹æƒ…å ±è¡¨ç¤º
            gameState.ctx.fillStyle = '#fff';
            gameState.ctx.font = '14px Arial';
            gameState.ctx.textAlign = 'left';
            gameState.ctx.fillText(`ç‰©ä½“: ${gameState.currentObject?.name || 'ç«‹æ–¹ä½“'}`, 10, 25);
            gameState.ctx.fillText(`è¦–ç‚¹: ${document.getElementById('currentViewpoint').textContent}`, 10, 45);
            gameState.ctx.fillText(`æ·±åº¦: ${gameState.currentDepth}`, 10, 65);
        }

        function drawGrid(centerX, centerY) {
            gameState.ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
            gameState.ctx.lineWidth = 1;
            
            // æ°´å¹³ç·š
            for (let i = -200; i <= 200; i += 40) {
                gameState.ctx.beginPath();
                gameState.ctx.moveTo(centerX - 200, centerY + i);
                gameState.ctx.lineTo(centerX + 200, centerY + i);
                gameState.ctx.stroke();
            }
            
            // å‚ç›´ç·š
            for (let i = -200; i <= 200; i += 40) {
                gameState.ctx.beginPath();
                gameState.ctx.moveTo(centerX + i, centerY - 200);
                gameState.ctx.lineTo(centerX + i, centerY + 200);
                gameState.ctx.stroke();
            }
        }

        function drawCubePerspective(x, y, scale) {
            const depth = gameState.currentDepth * 5;
            
            gameState.ctx.fillStyle = '#4caf50';
            gameState.ctx.strokeStyle = '#fff';
            gameState.ctx.lineWidth = 2;
            
            switch (gameState.currentViewpoint) {
                case 'front':
                    // æ­£é¢è¦–ç‚¹ - æ­£æ–¹å½¢
                    gameState.ctx.fillRect(x - scale/2, y - scale/2, scale, scale);
                    gameState.ctx.strokeRect(x - scale/2, y - scale/2, scale, scale);
                    break;
                case 'diagonal':
                case 'perspective':
                    // é è¿‘è¦–ç‚¹ - ç«‹æ–¹ä½“
                    // å‰é¢
                    gameState.ctx.fillRect(x - scale/2, y - scale/2, scale, scale);
                    gameState.ctx.strokeRect(x - scale/2, y - scale/2, scale, scale);
                    // ä¸Šé¢
                    gameState.ctx.fillStyle = '#66bb6a';
                    gameState.ctx.beginPath();
                    gameState.ctx.moveTo(x - scale/2, y - scale/2);
                    gameState.ctx.lineTo(x - scale/2 + depth, y - scale/2 - depth);
                    gameState.ctx.lineTo(x + scale/2 + depth, y - scale/2 - depth);
                    gameState.ctx.lineTo(x + scale/2, y - scale/2);
                    gameState.ctx.closePath();
                    gameState.ctx.fill();
                    gameState.ctx.stroke();
                    // å³é¢
                    gameState.ctx.fillStyle = '#388e3c';
                    gameState.ctx.beginPath();
                    gameState.ctx.moveTo(x + scale/2, y - scale/2);
                    gameState.ctx.lineTo(x + scale/2 + depth, y - scale/2 - depth);
                    gameState.ctx.lineTo(x + scale/2 + depth, y + scale/2 - depth);
                    gameState.ctx.lineTo(x + scale/2, y + scale/2);
                    gameState.ctx.closePath();
                    gameState.ctx.fill();
                    gameState.ctx.stroke();
                    break;
                case 'top':
                    // ä¸Šé¢è¦–ç‚¹ - æ­£æ–¹å½¢
                    gameState.ctx.fillRect(x - scale/2, y - scale/2, scale, scale);
                    gameState.ctx.strokeRect(x - scale/2, y - scale/2, scale, scale);
                    break;
                case 'side':
                    // å´é¢è¦–ç‚¹ - æ­£æ–¹å½¢
                    gameState.ctx.fillRect(x - scale/2, y - scale/2, scale, scale);
                    gameState.ctx.strokeRect(x - scale/2, y - scale/2, scale, scale);
                    break;
                default:
                    // ãã®ä»–ã®è¦–ç‚¹ - å¤‰å½¢æ­£æ–¹å½¢
                    const offset = depth * 0.3;
                    gameState.ctx.fillRect(x - scale/2 + offset, y - scale/2 + offset, scale, scale);
                    gameState.ctx.strokeRect(x - scale/2 + offset, y - scale/2 + offset, scale, scale);
            }
        }

        function drawSpherePerspective(x, y, scale) {
            gameState.ctx.fillStyle = '#2196f3';
            gameState.ctx.strokeStyle = '#fff';
            gameState.ctx.lineWidth = 2;
            
            // ã©ã®è¦–ç‚¹ã§ã‚‚å††å½¢
            gameState.ctx.beginPath();
            gameState.ctx.arc(x, y, scale/2, 0, 2 * Math.PI);
            gameState.ctx.fill();
            gameState.ctx.stroke();
            
            // çƒé¢è¡¨ç¾ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ
            const highlightSize = scale * 0.15;
            gameState.ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
            gameState.ctx.beginPath();
            gameState.ctx.arc(x - scale/4, y - scale/4, highlightSize, 0, 2 * Math.PI);
            gameState.ctx.fill();
        }

        function drawCylinderPerspective(x, y, scale) {
            gameState.ctx.fillStyle = '#ff9800';
            gameState.ctx.strokeStyle = '#fff';
            gameState.ctx.lineWidth = 2;
            
            switch (gameState.currentViewpoint) {
                case 'top':
                case 'bottom':
                    // ä¸Šé¢ãƒ»åº•é¢è¦–ç‚¹ - å††å½¢
                    gameState.ctx.beginPath();
                    gameState.ctx.arc(x, y, scale/2, 0, 2 * Math.PI);
                    gameState.ctx.fill();
                    gameState.ctx.stroke();
                    break;
                case 'side':
                case 'front':
                case 'back':
                    // å´é¢è¦–ç‚¹ - é•·æ–¹å½¢
                    gameState.ctx.fillRect(x - scale/2, y - scale/2, scale, scale);
                    gameState.ctx.strokeRect(x - scale/2, y - scale/2, scale, scale);
                    break;
                default:
                    // é è¿‘è¦–ç‚¹ - æ¥•å††ã¨çŸ©å½¢ã®çµ„ã¿åˆã‚ã›
                    const depth = gameState.currentDepth * 3;
                    // å´é¢
                    gameState.ctx.fillRect(x - scale/2, y - scale/2, scale, scale);
                    gameState.ctx.strokeRect(x - scale/2, y - scale/2, scale, scale);
                    // ä¸Šé¢æ¥•å††
                    gameState.ctx.fillStyle = '#ffb74d';
                    gameState.ctx.beginPath();
                    gameState.ctx.ellipse(x, y - scale/2, scale/2, depth, 0, 0, 2 * Math.PI);
                    gameState.ctx.fill();
                    gameState.ctx.stroke();
            }
        }

        function drawConePerspective(x, y, scale) {
            gameState.ctx.fillStyle = '#9c27b0';
            gameState.ctx.strokeStyle = '#fff';
            gameState.ctx.lineWidth = 2;
            
            switch (gameState.currentViewpoint) {
                case 'top':
                    // ä¸Šé¢è¦–ç‚¹ - ç‚¹
                    gameState.ctx.beginPath();
                    gameState.ctx.arc(x, y, 5, 0, 2 * Math.PI);
                    gameState.ctx.fill();
                    gameState.ctx.stroke();
                    break;
                case 'bottom':
                    // åº•é¢è¦–ç‚¹ - å††å½¢
                    gameState.ctx.beginPath();
                    gameState.ctx.arc(x, y, scale/2, 0, 2 * Math.PI);
                    gameState.ctx.fill();
                    gameState.ctx.stroke();
                    break;
                default:
                    // å´é¢ãƒ»é è¿‘è¦–ç‚¹ - ä¸‰è§’å½¢
                    gameState.ctx.beginPath();
                    gameState.ctx.moveTo(x, y - scale/2);
                    gameState.ctx.lineTo(x - scale/2, y + scale/2);
                    gameState.ctx.lineTo(x + scale/2, y + scale/2);
                    gameState.ctx.closePath();
                    gameState.ctx.fill();
                    gameState.ctx.stroke();
            }
        }

        function checkUnderstanding() {
            // ç†è§£åº¦ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆç°¡æ˜“ç‰ˆï¼‰
            const understanding = Math.random() * 0.4 + 0.6; // 60-100%ã®ç†è§£åº¦
            
            let message = `ğŸ“ ãƒ‘ãƒ¼ã‚¹ãƒšã‚¯ãƒ†ã‚£ãƒ–ç†è§£ãƒã‚§ãƒƒã‚¯\\n\\n`;
            message += `ç‰©ä½“: ${gameState.currentObject.name}\\n`;
            message += `è¦–ç‚¹: ${document.getElementById('currentViewpoint').textContent}\\n`;
            message += `ç†è§£åº¦: ${(understanding * 100).toFixed(1)}%\\n\\n`;
            
            if (understanding >= 0.9) {
                message += 'ğŸ† å®Œç’§ãªç†è§£ã§ã™ï¼';
                gameState.understoodCount++;
                gameState.score += 100;
            } else if (understanding >= 0.7) {
                message += 'ğŸ‘ è‰¯ã„ç†è§£ã§ã™ï¼';
                gameState.understoodCount++;
                gameState.score += 50;
            } else {
                message += 'ğŸ“š ã‚‚ã†å°‘ã—è¦³å¯Ÿã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚';
            }
            
            alert(message);
            
            gameState.currentTransform++;
            setTimeout(() => {
                generateNewObject();
                updateDisplay();
            }, 1000);
        }

        function showPerspectiveGuide() {
            const guides = [
                'ğŸ” ç‰©ä½“ã‚’ç•°ãªã‚‹è§’åº¦ã‹ã‚‰è¦³å¯Ÿã—ã¦ã¿ã¾ã—ã‚‡ã†',
                'ğŸ“ é è¿‘æ³•ã§ã¯é ãã®ç‰©ä½“ã»ã©å°ã•ãè¦‹ãˆã¾ã™',
                'ğŸ‘ï¸ è¦–ç‚¹ã®é«˜ã•ã§è¦‹ãˆæ–¹ãŒå¤§ããå¤‰ã‚ã‚Šã¾ã™',
                'ğŸ“ ç­‰è§’è¦–ç‚¹ã§ã¯æ¯”ä¾‹é–¢ä¿‚ãŒä¿ãŸã‚Œã¾ã™',
                'ğŸ¯ æ·±åº¦ã‚’èª¿æ•´ã—ã¦ç«‹ä½“æ„Ÿã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†'
            ];
            
            const randomGuide = guides[Math.floor(Math.random() * guides.length)];
            alert(`ãƒ‘ãƒ¼ã‚¹ãƒšã‚¯ãƒ†ã‚£ãƒ–ã®ã‚³ãƒ„:\\n${randomGuide}`);
        }

        function resetPerspective() {
            if (confirm('ç¾åœ¨ã®è¦–ç‚¹ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿé€²è¡ŒçŠ¶æ³ãŒå¤±ã‚ã‚Œã¾ã™ã€‚')) {
                gameState.currentViewpoint = 'front';
                gameState.currentDepth = 5;
                
                // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã¨è¡¨ç¤ºã‚’ãƒªã‚»ãƒƒãƒˆ
                document.getElementById('depthSlider').value = 5;
                
                // ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
                document.querySelectorAll('.viewpoint-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                updateViewpointDisplay();
                drawPerspective();
            }
        }

        function newPerspectiveChallenge() {
            if (confirm('æ–°ã—ã„ç‰©ä½“ã‚’è¡¨ç¤ºã—ã¾ã™ã‹ï¼Ÿç¾åœ¨ã®é€²è¡ŒçŠ¶æ³ãŒå¤±ã‚ã‚Œã¾ã™ã€‚')) {
                generateNewObject();
                updateDisplay();
            }
        }

        function updateDisplay() {
            document.getElementById('currentTransform').textContent = Math.min(gameState.currentTransform, gameState.totalTransforms);
            document.getElementById('understoodCount').textContent = gameState.understoodCount;
            document.getElementById('score').textContent = gameState.score;
            
            const understandingRate = gameState.currentTransform > 1 ? 
                ((gameState.understoodCount / (gameState.currentTransform - 1)) * 100).toFixed(1) : 0;
            document.getElementById('understandingRate').textContent = `${understandingRate}%`;
            
            const progress = ((gameState.currentTransform - 1) / gameState.totalTransforms) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
            
            // ç†è§£çŠ¶æ³ã®æ›´æ–°
            if (understandingRate >= 90) {
                document.getElementById('understandingStatus').textContent = 'å„ªç§€';
            } else if (understandingRate >= 70) {
                document.getElementById('understandingStatus').textContent = 'è‰¯å¥½';
            } else {
                document.getElementById('understandingStatus').textContent = 'å­¦ç¿’ä¸­';
            }
            
            // ã‚²ãƒ¼ãƒ çµ‚äº†ãƒã‚§ãƒƒã‚¯
            if (gameState.currentTransform > gameState.totalTransforms) {
                setTimeout(endGame, 1000);
            }
        }

        function endGame() {
            const understandingRate = ((gameState.understoodCount / gameState.totalTransforms) * 100).toFixed(1);
            const passed = understandingRate >= 90;
            
            let message = `ğŸŠ ãƒ‘ãƒ¼ã‚¹ãƒšã‚¯ãƒ†ã‚£ãƒ–ã‚²ãƒ¼ãƒ å®Œäº†ï¼\\n\\n`;
            message += `ç†è§£å¤‰æ›: ${gameState.understoodCount} / ${gameState.totalTransforms}\\n`;
            message += `ç†è§£åº¦: ${understandingRate}%\\n`;
            message += `æœ€çµ‚ã‚¹ã‚³ã‚¢: ${gameState.score}ç‚¹\\n\\n`;
            
            if (passed) {
                message += `ğŸ† ã‚¯ãƒªã‚¢é”æˆï¼\\nå„ªç§€ãªç©ºé–“èªè­˜èƒ½åŠ›ã§ã™ï¼`;
            } else {
                message += `ğŸ“š ã‚‚ã†å°‘ã—é ‘å¼µã‚Šã¾ã—ã‚‡ã†ã€‚\\n90%ä»¥ä¸Šã®ç†è§£åº¦ã‚’ç›®æŒ‡ã—ã¦ãã ã•ã„ã€‚`;
            }
            
            alert(message);
            
            if (confirm('ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                initializeGame();
            }
        }

        function goBack() {
            window.location.href = '../index.html';
        }

        // ã‚²ãƒ¼ãƒ åˆæœŸåŒ–
        initializeGame();
    </script>
</body>
</html>