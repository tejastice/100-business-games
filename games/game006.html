<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šé‡ã‚¿ã‚¹ã‚¯åå¿œ - ã‚²ãƒ¼ãƒ 006</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .multitask-game {
            width: 800px;
            height: 900px;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
        }

        .game-header {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            color: white;
            font-weight: bold;
            font-size: 14px;
            text-align: center;
        }

        .instruction-panel {
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.05);
            text-align: center;
            color: white;
        }

        .instruction-text {
            font-size: 16px;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .task-priorities {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .priority-indicator {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .priority-indicator.high { background: rgba(231, 76, 60, 0.3); color: #e74c3c; }
        .priority-indicator.medium { background: rgba(243, 156, 18, 0.3); color: #f39c12; }
        .priority-indicator.low { background: rgba(39, 174, 96, 0.3); color: #27ae60; }

        .game-area {
            padding: 20px;
        }

        .task-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            height: 400px;
        }

        .task-panel {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            position: relative;
        }

        .task-panel.priority-high {
            border-color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
        }

        .task-panel.priority-medium {
            border-color: #f39c12;
            background: rgba(243, 156, 18, 0.1);
        }

        .task-panel.priority-low {
            border-color: #27ae60;
            background: rgba(39, 174, 96, 0.1);
        }

        .task-panel.urgent {
            animation: urgentPulse 1s ease-in-out infinite;
        }

        @keyframes urgentPulse {
            0%, 100% { box-shadow: 0 0 0 rgba(231, 76, 60, 0.8); }
            50% { box-shadow: 0 0 20px rgba(231, 76, 60, 0.8); }
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            color: white;
        }

        .task-title {
            font-weight: bold;
            font-size: 14px;
        }

        .task-accuracy {
            font-size: 12px;
            opacity: 0.8;
        }

        .task-content {
            height: calc(100% - 40px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        /* è‰²è­˜åˆ¥ã‚¿ã‚¹ã‚¯ */
        .color-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid white;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }

        .color-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
            width: 100%;
        }

        .color-btn {
            padding: 8px;
            border: none;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .color-btn.red { background: #e74c3c; }
        .color-btn.blue { background: #3498db; }
        .color-btn.green { background: #27ae60; }
        .color-btn.yellow { background: #f1c40f; }

        .color-btn:hover {
            transform: scale(1.05);
        }

        .color-instruction {
            color: white;
            font-size: 12px;
            text-align: center;
        }

        /* æ•°å­—è¨ˆç®—ã‚¿ã‚¹ã‚¯ */
        .math-problem {
            font-size: 24px;
            font-weight: bold;
            color: white;
            margin-bottom: 15px;
            text-align: center;
        }

        .math-input {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        #mathAnswer {
            width: 80px;
            padding: 8px;
            border: 2px solid #3498db;
            border-radius: 5px;
            text-align: center;
            font-size: 16px;
        }

        #mathSubmit {
            padding: 8px 12px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        #mathSubmit:hover {
            background: #2980b9;
        }

        /* ãƒ‘ã‚¿ãƒ¼ãƒ³è¨˜æ†¶ã‚¿ã‚¹ã‚¯ */
        .pattern-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 15px;
        }

        .pattern-cell {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pattern-cell.active {
            background: #f39c12;
            border-color: #e67e22;
        }

        .pattern-cell.highlighted {
            background: #3498db;
            border-color: #2980b9;
        }

        /* åå¿œé€Ÿåº¦ã‚¿ã‚¹ã‚¯ */
        .reaction-target {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #95a5a6;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 10px;
        }

        .reaction-target.ready {
            background: #e74c3c;
            animation: readyPulse 1s ease-in-out infinite;
        }

        .reaction-target.go {
            background: #27ae60;
        }

        @keyframes readyPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .game-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 20px;
        }

        .start-button, .reset-button {
            padding: 12px 30px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .start-button {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
        }

        .start-button:hover:not(:disabled) {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
            transform: translateY(-2px);
        }

        .start-button:disabled {
            background: #7f8c8d;
            cursor: not-allowed;
        }

        .reset-button {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }

        .reset-button:hover {
            background: linear-gradient(45deg, #c0392b, #e74c3c);
            transform: translateY(-2px);
        }

        .game-results {
            background: rgba(255, 255, 255, 0.9);
            margin: 20px;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            color: #333;
        }

        .victory-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 100;
        }
    </style>
</head>
<body>
    <button class="back-btn" onclick="goBack()">â† ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>

    <div class="multitask-game">
        <div class="game-header">
            <div class="round-display">ãƒ©ã‚¦ãƒ³ãƒ‰: <span id="currentRound">0</span>/20</div>
            <div class="time-display">æ®‹ã‚Šæ™‚é–“: <span id="timer">30</span>ç§’</div>
            <div class="overall-accuracy">ç·åˆæ­£è§£ç‡: <span id="overallAccuracy">100</span>%</div>
            <div class="score-display">ã‚¹ã‚³ã‚¢: <span id="score">0</span></div>
        </div>
        
        <div class="instruction-panel">
            <div class="instruction-text">4ã¤ã®ã‚¿ã‚¹ã‚¯ã‚’åŒæ™‚ã«ç®¡ç†ã—ã¦ãã ã•ã„</div>
            <div class="task-priorities" id="taskPriorities">
                <span class="priority-indicator high">é«˜å„ªå…ˆåº¦</span>
                <span class="priority-indicator medium">ä¸­å„ªå…ˆåº¦</span>
                <span class="priority-indicator low">ä½å„ªå…ˆåº¦</span>
            </div>
        </div>
        
        <div class="game-area" id="gameArea">
            <div class="task-container">
                <!-- ã‚¿ã‚¹ã‚¯1: è‰²è­˜åˆ¥ -->
                <div class="task-panel color-task" id="colorTask">
                    <div class="task-header">
                        <span class="task-title">è‰²è­˜åˆ¥</span>
                        <span class="task-accuracy">æ­£è§£ç‡: <span id="colorAccuracy">100</span>%</span>
                    </div>
                    <div class="task-content">
                        <div class="color-circle" id="colorCircle"></div>
                        <div class="color-instruction" id="colorInstruction">è‰²ãŒå¤‰ã‚ã£ãŸã‚‰ã‚¯ãƒªãƒƒã‚¯</div>
                        <div class="color-buttons">
                            <button class="color-btn red" data-color="red">èµ¤</button>
                            <button class="color-btn blue" data-color="blue">é’</button>
                            <button class="color-btn green" data-color="green">ç·‘</button>
                            <button class="color-btn yellow" data-color="yellow">é»„</button>
                        </div>
                    </div>
                </div>
                
                <!-- ã‚¿ã‚¹ã‚¯2: æ•°å­—è¨ˆç®— -->
                <div class="task-panel math-task" id="mathTask">
                    <div class="task-header">
                        <span class="task-title">æ•°å­—è¨ˆç®—</span>
                        <span class="task-accuracy">æ­£è§£ç‡: <span id="mathAccuracy">100</span>%</span>
                    </div>
                    <div class="task-content">
                        <div class="math-problem" id="mathProblem">3 + 5 = ?</div>
                        <div class="math-input">
                            <input type="number" id="mathAnswer" placeholder="ç­”ãˆ">
                            <button id="mathSubmit">å›ç­”</button>
                        </div>
                    </div>
                </div>
                
                <!-- ã‚¿ã‚¹ã‚¯3: ãƒ‘ã‚¿ãƒ¼ãƒ³è¨˜æ†¶ -->
                <div class="task-panel pattern-task" id="patternTask">
                    <div class="task-header">
                        <span class="task-title">ãƒ‘ã‚¿ãƒ¼ãƒ³è¨˜æ†¶</span>
                        <span class="task-accuracy">æ­£è§£ç‡: <span id="patternAccuracy">100</span>%</span>
                    </div>
                    <div class="task-content">
                        <div class="pattern-grid" id="patternGrid">
                            <div class="pattern-cell" data-index="0"></div>
                            <div class="pattern-cell" data-index="1"></div>
                            <div class="pattern-cell" data-index="2"></div>
                            <div class="pattern-cell" data-index="3"></div>
                        </div>
                        <div class="pattern-instruction" id="patternInstruction">ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¨˜æ†¶</div>
                    </div>
                </div>
                
                <!-- ã‚¿ã‚¹ã‚¯4: åå¿œé€Ÿåº¦ -->
                <div class="task-panel reaction-task" id="reactionTask">
                    <div class="task-header">
                        <span class="task-title">åå¿œé€Ÿåº¦</span>
                        <span class="task-accuracy">æ­£è§£ç‡: <span id="reactionAccuracy">100</span>%</span>
                    </div>
                    <div class="task-content">
                        <div class="reaction-target" id="reactionTarget">å¾…æ©Ÿä¸­</div>
                        <div class="reaction-instruction" id="reactionInstruction">ç·‘ã«ãªã£ãŸã‚‰ã‚¯ãƒªãƒƒã‚¯</div>
                        <div class="last-reaction">æœ€æ–°: <span id="lastReaction">---</span>ms</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="game-controls">
            <button id="startBtn" class="start-button">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
            <button id="resetBtn" class="reset-button">ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
        
        <div class="game-results" id="results" style="display: none;">
            <h3>çµæœ</h3>
            <p>å®Œäº†ãƒ©ã‚¦ãƒ³ãƒ‰: <span id="finalRound">0</span>/20</p>
            <p>ç·åˆæ­£è§£ç‡: <span id="finalAccuracy">0</span>%</p>
            <p>æœ€çµ‚ã‚¹ã‚³ã‚¢: <span id="finalScore">0</span></p>
            <p>ãƒãƒ«ãƒã‚¿ã‚¹ã‚¯è©•ä¾¡: <span id="multitaskRating">---</span></p>
        </div>

        <!-- è©³ç´°ãƒ«ãƒ¼ãƒ«ãƒ»éŠã³æ–¹ -->
        <div class="instructions" style="background: rgba(255, 255, 255, 0.1); padding: 20px; border-radius: 15px; margin-top: 20px; text-align: left; flex-shrink: 0;">
            <h3 style="color: #ffeb3b; margin-bottom: 15px;">ğŸ“‹ è©³ç´°ãƒ«ãƒ¼ãƒ«ãƒ»éŠã³æ–¹</h3>
            
            <div style="margin-bottom: 15px;">
                <h4 style="color: #4caf50; margin-bottom: 8px;">ğŸ¯ ç›®çš„</h4>
                <p>4ã¤ã®ç•°ãªã‚‹ã‚¿ã‚¹ã‚¯ã‚’åŒæ™‚ã«ç®¡ç†ã—ã€æ³¨æ„ã‚’åˆ†æ•£ã•ã›ãªãŒã‚‰åŠ¹ç‡çš„ã«å‡¦ç†ã™ã‚‹èƒ½åŠ›ã‚’é›ãˆã‚‹</p>
            </div>

            <div style="margin-bottom: 15px;">
                <h4 style="color: #4caf50; margin-bottom: 8px;">ğŸ® ã‚²ãƒ¼ãƒ ã®æµã‚Œ</h4>
                <ul style="padding-left: 20px;">
                    <li>20ãƒ©ã‚¦ãƒ³ãƒ‰å®Ÿæ–½ï¼ˆå„ãƒ©ã‚¦ãƒ³ãƒ‰30ç§’ï¼‰</li>
                    <li>4ã¤ã®ã‚¿ã‚¹ã‚¯ãŒåŒæ™‚ã«é€²è¡Œï¼šè‰²è­˜åˆ¥ãƒ»æ•°å­¦è¨ˆç®—ãƒ»ãƒ‘ã‚¿ãƒ¼ãƒ³è¨˜æ†¶ãƒ»åå¿œé€Ÿåº¦</li>
                    <li>å„ã‚¿ã‚¹ã‚¯ã«å„ªå…ˆåº¦ï¼ˆé«˜ãƒ»ä¸­ãƒ»ä½ï¼‰ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹</li>
                    <li>é«˜å„ªå…ˆåº¦ã‚¿ã‚¹ã‚¯ã‹ã‚‰å‡¦ç†ã™ã‚‹ã“ã¨ã§åŠ¹ç‡ã‚¢ãƒƒãƒ—</li>
                </ul>
            </div>

            <div style="margin-bottom: 15px;">
                <h4 style="color: #4caf50; margin-bottom: 8px;">ğŸ“Š 4ã¤ã®ã‚¿ã‚¹ã‚¯è©³ç´°</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                    <div style="background: rgba(255, 255, 255, 0.1); padding: 10px; border-radius: 8px;">
                        <strong style="color: #e74c3c;">ğŸ”´ è‰²è­˜åˆ¥</strong><br>
                        è¡¨ç¤ºã•ã‚ŒãŸè‰²ã«å¯¾å¿œã™ã‚‹ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
                    </div>
                    <div style="background: rgba(255, 255, 255, 0.1); padding: 10px; border-radius: 8px;">
                        <strong style="color: #3498db;">ğŸ”¢ æ•°å­¦è¨ˆç®—</strong><br>
                        ç°¡å˜ãªå››å‰‡æ¼”ç®—å•é¡Œã‚’è§£ç­”
                    </div>
                    <div style="background: rgba(255, 255, 255, 0.1); padding: 10px; border-radius: 8px;">
                        <strong style="color: #f39c12;">ğŸ§© ãƒ‘ã‚¿ãƒ¼ãƒ³è¨˜æ†¶</strong><br>
                        ç‚¹æ»…ã—ãŸã‚»ãƒ«ã®é †åºã‚’è¨˜æ†¶ãƒ»å†ç¾
                    </div>
                    <div style="background: rgba(255, 255, 255, 0.1); padding: 10px; border-radius: 8px;">
                        <strong style="color: #9b59b6;">âš¡ åå¿œé€Ÿåº¦</strong><br>
                        ã€ŒGO!ã€è¡¨ç¤ºå¾Œã«å³åº§ã«ã‚¯ãƒªãƒƒã‚¯
                    </div>
                </div>
            </div>

            <div style="margin-bottom: 15px;">
                <h4 style="color: #4caf50; margin-bottom: 8px;">ğŸ† ã‚¯ãƒªã‚¢æ¡ä»¶</h4>
                <ul style="padding-left: 20px;">
                    <li><strong>ç·åˆæ­£è§£ç‡75%ä»¥ä¸Š</strong>ã§é”æˆ</li>
                    <li>å„ã‚¿ã‚¹ã‚¯ã®æ­£è§£ç‡ã‚‚ãƒãƒ©ãƒ³ã‚¹è‰¯ãä¿ã¤ã“ã¨ãŒé‡è¦</li>
                    <li>å„ªå…ˆåº¦ã®é«˜ã„ã‚¿ã‚¹ã‚¯ã‚’å„ªå…ˆçš„ã«å‡¦ç†ã™ã‚‹ã¨é«˜å¾—ç‚¹</li>
                </ul>
            </div>

            <div style="margin-bottom: 15px;">
                <h4 style="color: #4caf50; margin-bottom: 8px;">ğŸ’¡ ãƒ—ãƒ¬ã‚¤ã®ã‚³ãƒ„</h4>
                <ul style="padding-left: 20px;">
                    <li>å„ªå…ˆåº¦è¡¨ç¤ºï¼ˆé«˜ãƒ»ä¸­ãƒ»ä½ï¼‰ã‚’å¸¸ã«ç¢ºèªã™ã‚‹</li>
                    <li>å®Œç’§ã‚’æ±‚ã‚ã™ããšã€å…¨ã¦ã®ã‚¿ã‚¹ã‚¯ã«é©åº¦ã«å¯¾å¿œã™ã‚‹</li>
                    <li>æ•°å­¦è¨ˆç®—ã¯æš—ç®—ã§ç´ æ—©ãã€ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯é›†ä¸­ã—ã¦è¨˜æ†¶</li>
                    <li>åå¿œé€Ÿåº¦ã¯è½ã¡ç€ã„ã¦ã€ŒGO!ã€ã‚’å¾…ã¤</li>
                </ul>
            </div>

            <div>
                <h4 style="color: #4caf50; margin-bottom: 8px;">ğŸ“ ç¿’å¾—ã§ãã‚‹ãƒ“ã‚¸ãƒã‚¹ã‚¹ã‚­ãƒ«</h4>
                <ul style="padding-left: 20px;">
                    <li><strong>ãƒãƒ«ãƒã‚¿ã‚¹ã‚¯å‡¦ç†èƒ½åŠ›</strong> - è¤‡æ•°ã®æ¥­å‹™ã‚’åŒæ™‚ä¸¦è¡Œã§ç®¡ç†</li>
                    <li><strong>å„ªå…ˆåº¦åˆ¤æ–­åŠ›</strong> - é‡è¦åº¦ã«å¿œã˜ãŸé©åˆ‡ãªå¯¾å¿œé †åºã®æ±ºå®š</li>
                    <li><strong>æ³¨æ„åˆ†æ•£èƒ½åŠ›</strong> - è¤‡æ•°ã®æƒ…å ±æºã«åŒæ™‚ã«æ³¨æ„ã‚’å‘ã‘ã‚‹</li>
                    <li><strong>åŠ¹ç‡çš„å‡¦ç†èƒ½åŠ›</strong> - é™ã‚‰ã‚ŒãŸæ™‚é–“ã§ã®æœ€é©ãªä½œæ¥­é…åˆ†</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        class MultitaskGame {
            constructor() {
                this.currentRound = 0;
                this.totalRounds = 20;
                this.roundTime = 30;
                this.timeLeft = this.roundTime;
                this.gameActive = false;
                this.gameTimer = null;
                this.score = 0;
                
                // ã‚¿ã‚¹ã‚¯ç®¡ç†
                this.tasks = {
                    color: { correct: 0, total: 0, active: false },
                    math: { correct: 0, total: 0, active: false },
                    pattern: { correct: 0, total: 0, active: false },
                    reaction: { correct: 0, total: 0, active: false }
                };
                
                // å„ã‚¿ã‚¹ã‚¯ã®çŠ¶æ…‹
                this.colorState = { targetColor: '', startTime: 0 };
                this.mathState = { problem: null, answer: 0 };
                this.patternState = { sequence: [], playerSequence: [], showPhase: true };
                this.reactionState = { startTime: 0, waiting: false };
                
                this.initElements();
                this.bindEvents();
            }

            initElements() {
                this.gameArea = document.getElementById('gameArea');
                this.currentRoundDisplay = document.getElementById('currentRound');
                this.timerDisplay = document.getElementById('timer');
                this.overallAccuracyDisplay = document.getElementById('overallAccuracy');
                this.scoreDisplay = document.getElementById('score');
                
                // è‰²è­˜åˆ¥ã‚¿ã‚¹ã‚¯
                this.colorCircle = document.getElementById('colorCircle');
                this.colorInstruction = document.getElementById('colorInstruction');
                this.colorAccuracyDisplay = document.getElementById('colorAccuracy');
                
                // æ•°å­—è¨ˆç®—ã‚¿ã‚¹ã‚¯
                this.mathProblem = document.getElementById('mathProblem');
                this.mathAnswer = document.getElementById('mathAnswer');
                this.mathSubmit = document.getElementById('mathSubmit');
                this.mathAccuracyDisplay = document.getElementById('mathAccuracy');
                
                // ãƒ‘ã‚¿ãƒ¼ãƒ³è¨˜æ†¶ã‚¿ã‚¹ã‚¯
                this.patternGrid = document.getElementById('patternGrid');
                this.patternInstruction = document.getElementById('patternInstruction');
                this.patternAccuracyDisplay = document.getElementById('patternAccuracy');
                
                // åå¿œé€Ÿåº¦ã‚¿ã‚¹ã‚¯
                this.reactionTarget = document.getElementById('reactionTarget');
                this.reactionInstruction = document.getElementById('reactionInstruction');
                this.lastReactionDisplay = document.getElementById('lastReaction');
                this.reactionAccuracyDisplay = document.getElementById('reactionAccuracy');
                
                // ãã®ä»–
                this.startBtn = document.getElementById('startBtn');
                this.resetBtn = document.getElementById('resetBtn');
                this.results = document.getElementById('results');
            }

            bindEvents() {
                this.startBtn.addEventListener('click', () => this.startGame());
                this.resetBtn.addEventListener('click', () => this.resetGame());
                
                // è‰²è­˜åˆ¥ã‚¤ãƒ™ãƒ³ãƒˆ
                const colorButtons = document.querySelectorAll('.color-btn');
                colorButtons.forEach(btn => {
                    btn.addEventListener('click', (e) => this.handleColorClick(e.target.dataset.color));
                });
                
                // æ•°å­—è¨ˆç®—ã‚¤ãƒ™ãƒ³ãƒˆ
                this.mathSubmit.addEventListener('click', () => this.handleMathSubmit());
                this.mathAnswer.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.handleMathSubmit();
                });
                
                // ãƒ‘ã‚¿ãƒ¼ãƒ³è¨˜æ†¶ã‚¤ãƒ™ãƒ³ãƒˆ
                this.patternGrid.addEventListener('click', (e) => {
                    if (e.target.classList.contains('pattern-cell')) {
                        this.handlePatternClick(parseInt(e.target.dataset.index));
                    }
                });
                
                // åå¿œé€Ÿåº¦ã‚¤ãƒ™ãƒ³ãƒˆ
                this.reactionTarget.addEventListener('click', () => this.handleReactionClick());
            }

            startGame() {
                this.gameActive = true;
                this.startBtn.disabled = true;
                this.results.style.display = 'none';
                
                this.currentRound = 0;
                this.score = 0;
                this.tasks = {
                    color: { correct: 0, total: 0, active: false },
                    math: { correct: 0, total: 0, active: false },
                    pattern: { correct: 0, total: 0, active: false },
                    reaction: { correct: 0, total: 0, active: false }
                };
                
                this.nextRound();
            }

            nextRound() {
                if (this.currentRound >= this.totalRounds) {
                    this.endGame();
                    return;
                }
                
                this.currentRound++;
                this.timeLeft = this.roundTime;
                
                this.updateDisplays();
                
                // å…¨ã‚¿ã‚¹ã‚¯ã‚’é–‹å§‹
                this.startColorTask();
                this.startMathTask();
                this.startPatternTask();
                this.startReactionTask();
                
                // ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹
                this.gameTimer = setInterval(() => {
                    this.timeLeft--;
                    this.timerDisplay.textContent = this.timeLeft;
                    
                    if (this.timeLeft <= 0) {
                        this.endRound();
                    }
                }, 1000);
            }

            // è‰²è­˜åˆ¥ã‚¿ã‚¹ã‚¯
            startColorTask() {
                this.tasks.color.active = true;
                this.scheduleColorChange();
            }

            scheduleColorChange() {
                if (!this.gameActive || !this.tasks.color.active) return;
                
                const colors = ['red', 'blue', 'green', 'yellow'];
                const newColor = colors[Math.floor(Math.random() * colors.length)];
                
                this.colorState.targetColor = newColor;
                this.colorState.startTime = Date.now();
                
                this.colorCircle.style.background = this.getColorCode(newColor);
                this.colorInstruction.textContent = `${newColor}ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„`;
                
                this.setPriority('color', this.getRandomPriority());
            }

            handleColorClick(clickedColor) {
                if (!this.tasks.color.active || !this.colorState.targetColor) return;
                
                this.tasks.color.total++;
                
                if (clickedColor === this.colorState.targetColor) {
                    this.tasks.color.correct++;
                    this.score += 10;
                }
                
                this.colorState.targetColor = '';
                this.updateTaskAccuracy('color');
                
                // æ¬¡ã®è‰²å¤‰æ›´ã‚’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
                setTimeout(() => this.scheduleColorChange(), 1000 + Math.random() * 2000);
            }

            // æ•°å­—è¨ˆç®—ã‚¿ã‚¹ã‚¯
            startMathTask() {
                this.tasks.math.active = true;
                this.generateMathProblem();
            }

            generateMathProblem() {
                if (!this.gameActive || !this.tasks.math.active) return;
                
                const operations = ['+', '-', '*'];
                const operation = operations[Math.floor(Math.random() * operations.length)];
                
                let a, b, answer;
                
                switch (operation) {
                    case '+':
                        a = Math.floor(Math.random() * 20) + 1;
                        b = Math.floor(Math.random() * 20) + 1;
                        answer = a + b;
                        break;
                    case '-':
                        a = Math.floor(Math.random() * 30) + 10;
                        b = Math.floor(Math.random() * a) + 1;
                        answer = a - b;
                        break;
                    case '*':
                        a = Math.floor(Math.random() * 10) + 1;
                        b = Math.floor(Math.random() * 10) + 1;
                        answer = a * b;
                        break;
                }
                
                this.mathState.problem = `${a} ${operation} ${b} = ?`;
                this.mathState.answer = answer;
                
                this.mathProblem.textContent = this.mathState.problem;
                this.mathAnswer.value = '';
                this.mathAnswer.focus();
                
                this.setPriority('math', this.getRandomPriority());
            }

            handleMathSubmit() {
                if (!this.tasks.math.active || !this.mathState.problem) return;
                
                const userAnswer = parseInt(this.mathAnswer.value);
                this.tasks.math.total++;
                
                if (userAnswer === this.mathState.answer) {
                    this.tasks.math.correct++;
                    this.score += 15;
                }
                
                this.mathState.problem = null;
                this.updateTaskAccuracy('math');
                
                // æ¬¡ã®å•é¡Œã‚’ç”Ÿæˆ
                setTimeout(() => this.generateMathProblem(), 2000 + Math.random() * 3000);
            }

            // ãƒ‘ã‚¿ãƒ¼ãƒ³è¨˜æ†¶ã‚¿ã‚¹ã‚¯
            startPatternTask() {
                this.tasks.pattern.active = true;
                this.generatePatternSequence();
            }

            generatePatternSequence() {
                if (!this.gameActive || !this.tasks.pattern.active) return;
                
                const sequenceLength = 2 + Math.floor(Math.random() * 3); // 2-4å€‹
                this.patternState.sequence = [];
                this.patternState.playerSequence = [];
                this.patternState.showPhase = true;
                
                for (let i = 0; i < sequenceLength; i++) {
                    this.patternState.sequence.push(Math.floor(Math.random() * 4));
                }
                
                this.patternInstruction.textContent = 'ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¨˜æ†¶ã—ã¦ãã ã•ã„';
                this.showPatternSequence();
                
                this.setPriority('pattern', this.getRandomPriority());
            }

            showPatternSequence() {
                let index = 0;
                
                const showNext = () => {
                    if (index >= this.patternState.sequence.length) {
                        this.patternState.showPhase = false;
                        this.patternInstruction.textContent = 'é †åºé€šã‚Šã«ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„';
                        return;
                    }
                    
                    const cellIndex = this.patternState.sequence[index];
                    const cell = document.querySelector(`[data-index="${cellIndex}"]`);
                    
                    cell.classList.add('highlighted');
                    
                    setTimeout(() => {
                        cell.classList.remove('highlighted');
                        index++;
                        setTimeout(showNext, 300);
                    }, 500);
                };
                
                showNext();
            }

            handlePatternClick(cellIndex) {
                if (!this.tasks.pattern.active || this.patternState.showPhase) return;
                
                this.patternState.playerSequence.push(cellIndex);
                
                const expectedIndex = this.patternState.playerSequence.length - 1;
                const expectedCell = this.patternState.sequence[expectedIndex];
                
                if (cellIndex !== expectedCell) {
                    // é–“é•ã„
                    this.tasks.pattern.total++;
                    this.updateTaskAccuracy('pattern');
                    this.scheduleNextPattern();
                    return;
                }
                
                // æ­£è§£ã®å ´åˆã€ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å®Œäº†ãƒã‚§ãƒƒã‚¯
                if (this.patternState.playerSequence.length === this.patternState.sequence.length) {
                    this.tasks.pattern.total++;
                    this.tasks.pattern.correct++;
                    this.score += 20;
                    this.updateTaskAccuracy('pattern');
                    this.scheduleNextPattern();
                }
            }

            scheduleNextPattern() {
                setTimeout(() => this.generatePatternSequence(), 3000 + Math.random() * 2000);
            }

            // åå¿œé€Ÿåº¦ã‚¿ã‚¹ã‚¯
            startReactionTask() {
                this.tasks.reaction.active = true;
                this.scheduleReactionTest();
            }

            scheduleReactionTest() {
                if (!this.gameActive || !this.tasks.reaction.active) return;
                
                this.reactionTarget.textContent = 'å¾…æ©Ÿä¸­';
                this.reactionTarget.className = 'reaction-target';
                this.reactionState.waiting = false;
                
                setTimeout(() => {
                    if (!this.gameActive || !this.tasks.reaction.active) return;
                    
                    this.reactionTarget.textContent = 'æº–å‚™';
                    this.reactionTarget.className = 'reaction-target ready';
                    
                    setTimeout(() => {
                        if (!this.gameActive || !this.tasks.reaction.active) return;
                        
                        this.reactionTarget.textContent = 'GO!';
                        this.reactionTarget.className = 'reaction-target go';
                        this.reactionState.startTime = Date.now();
                        this.reactionState.waiting = true;
                        
                        // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆ3ç§’ï¼‰
                        setTimeout(() => {
                            if (this.reactionState.waiting) {
                                this.tasks.reaction.total++;
                                this.updateTaskAccuracy('reaction');
                                this.scheduleReactionTest();
                            }
                        }, 3000);
                    }, 1000 + Math.random() * 2000);
                }, 2000 + Math.random() * 3000);
                
                this.setPriority('reaction', this.getRandomPriority());
            }

            handleReactionClick() {
                if (!this.tasks.reaction.active || !this.reactionState.waiting) return;
                
                const reactionTime = Date.now() - this.reactionState.startTime;
                this.reactionState.waiting = false;
                this.tasks.reaction.total++;
                
                this.lastReactionDisplay.textContent = reactionTime + 'ms';
                
                if (reactionTime <= 600) { // 600msä»¥å†…ã§æˆåŠŸ
                    this.tasks.reaction.correct++;
                    this.score += 25;
                }
                
                this.updateTaskAccuracy('reaction');
                setTimeout(() => this.scheduleReactionTest(), 1000);
            }

            // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ¡ã‚½ãƒƒãƒ‰
            getColorCode(colorName) {
                const colorMap = {
                    'red': '#e74c3c',
                    'blue': '#3498db',
                    'green': '#27ae60',
                    'yellow': '#f1c40f'
                };
                return colorMap[colorName];
            }

            getRandomPriority() {
                const priorities = ['high', 'medium', 'low'];
                return priorities[Math.floor(Math.random() * priorities.length)];
            }

            setPriority(taskName, priority) {
                const taskPanel = document.getElementById(`${taskName}Task`);
                taskPanel.className = `task-panel ${taskName}-task priority-${priority}`;
                
                if (priority === 'high') {
                    taskPanel.classList.add('urgent');
                }
            }

            updateTaskAccuracy(taskName) {
                const task = this.tasks[taskName];
                const accuracy = task.total > 0 ? Math.round((task.correct / task.total) * 100) : 100;
                
                const accuracyDisplay = document.getElementById(`${taskName}Accuracy`);
                accuracyDisplay.textContent = accuracy;
            }

            updateDisplays() {
                this.currentRoundDisplay.textContent = this.currentRound;
                this.scoreDisplay.textContent = this.score;
                
                // ç·åˆæ­£è§£ç‡è¨ˆç®—
                let totalCorrect = 0;
                let totalAttempts = 0;
                
                Object.values(this.tasks).forEach(task => {
                    totalCorrect += task.correct;
                    totalAttempts += task.total;
                });
                
                const overallAccuracy = totalAttempts > 0 ? Math.round((totalCorrect / totalAttempts) * 100) : 100;
                this.overallAccuracyDisplay.textContent = overallAccuracy;
            }

            endRound() {
                clearInterval(this.gameTimer);
                
                // å…¨ã‚¿ã‚¹ã‚¯ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
                Object.keys(this.tasks).forEach(taskName => {
                    this.tasks[taskName].active = false;
                });
                
                // æ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã¾ã§å°‘ã—å¾…æ©Ÿ
                setTimeout(() => {
                    if (this.gameActive) {
                        this.nextRound();
                    }
                }, 2000);
            }

            endGame() {
                this.gameActive = false;
                clearInterval(this.gameTimer);
                
                // å…¨ã‚¿ã‚¹ã‚¯ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
                Object.keys(this.tasks).forEach(taskName => {
                    this.tasks[taskName].active = false;
                });
                
                // æœ€çµ‚çµæœè¨ˆç®—
                let totalCorrect = 0;
                let totalAttempts = 0;
                
                Object.values(this.tasks).forEach(task => {
                    totalCorrect += task.correct;
                    totalAttempts += task.total;
                });
                
                const finalAccuracy = totalAttempts > 0 ? Math.round((totalCorrect / totalAttempts) * 100) : 0;
                
                // è©•ä¾¡è¨ˆç®—
                let rating = '';
                if (finalAccuracy >= 75 && this.score >= 2000) {
                    rating = 'ãƒãƒ«ãƒã‚¿ã‚¹ã‚¯ãƒã‚¹ã‚¿ãƒ¼';
                } else if (finalAccuracy >= 65 && this.score >= 1500) {
                    rating = 'å„ªç§€ãªãƒãƒ«ãƒã‚¿ã‚¹ã‚¯èƒ½åŠ›';
                } else if (finalAccuracy >= 55 && this.score >= 1000) {
                    rating = 'è‰¯å¥½ãªãƒãƒ«ãƒã‚¿ã‚¹ã‚¯èƒ½åŠ›';
                } else if (finalAccuracy >= 45) {
                    rating = 'å¹³å‡çš„ãƒãƒ«ãƒã‚¿ã‚¹ã‚¯èƒ½åŠ›';
                } else {
                    rating = 'ãƒãƒ«ãƒã‚¿ã‚¹ã‚¯è¦ç·´ç¿’';
                }
                
                // çµæœè¡¨ç¤º
                document.getElementById('finalRound').textContent = this.currentRound;
                document.getElementById('finalAccuracy').textContent = finalAccuracy;
                document.getElementById('finalScore').textContent = this.score;
                document.getElementById('multitaskRating').textContent = rating;
                
                this.results.style.display = 'block';
                this.startBtn.disabled = false;
                
                // å‹åˆ©åˆ¤å®šï¼ˆç·åˆæ­£è§£ç‡75%ä»¥ä¸Šï¼‰
                if (finalAccuracy >= 75) {
                    this.showVictoryMessage();
                }
            }

            showVictoryMessage() {
                const victory = document.createElement('div');
                victory.className = 'victory-message';
                victory.innerHTML = '<h2>ğŸ§  ã‚¯ãƒªã‚¢ï¼ ğŸ§ </h2><p>å®Œç’§ãªãƒãƒ«ãƒã‚¿ã‚¹ã‚¯èƒ½åŠ›ã§ã™ï¼</p>';
                this.gameArea.appendChild(victory);
                
                setTimeout(() => {
                    if (victory.parentNode) {
                        victory.parentNode.removeChild(victory);
                    }
                }, 4000);
            }

            resetGame() {
                this.gameActive = false;
                clearInterval(this.gameTimer);
                
                this.currentRound = 0;
                this.timeLeft = this.roundTime;
                this.score = 0;
                this.tasks = {
                    color: { correct: 0, total: 0, active: false },
                    math: { correct: 0, total: 0, active: false },
                    pattern: { correct: 0, total: 0, active: false },
                    reaction: { correct: 0, total: 0, active: false }
                };
                
                // UI ãƒªã‚»ãƒƒãƒˆ
                this.currentRoundDisplay.textContent = '0';
                this.timerDisplay.textContent = '30';
                this.overallAccuracyDisplay.textContent = '100';
                this.scoreDisplay.textContent = '0';
                
                // å„ã‚¿ã‚¹ã‚¯è¡¨ç¤ºãƒªã‚»ãƒƒãƒˆ
                ['color', 'math', 'pattern', 'reaction'].forEach(taskName => {
                    document.getElementById(`${taskName}Accuracy`).textContent = '100';
                    
                    const taskPanel = document.getElementById(`${taskName}Task`);
                    taskPanel.className = `task-panel ${taskName}-task`;
                });
                
                this.colorInstruction.textContent = 'è‰²ãŒå¤‰ã‚ã£ãŸã‚‰ã‚¯ãƒªãƒƒã‚¯';
                this.mathProblem.textContent = 'å¾…æ©Ÿä¸­...';
                this.mathAnswer.value = '';
                this.patternInstruction.textContent = 'ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¨˜æ†¶';
                this.reactionTarget.textContent = 'å¾…æ©Ÿä¸­';
                this.reactionTarget.className = 'reaction-target';
                this.lastReactionDisplay.textContent = '---';
                
                this.results.style.display = 'none';
                this.startBtn.disabled = false;
                
                // ã‚¨ãƒ•ã‚§ã‚¯ãƒˆè¦ç´ ã‚’ã‚¯ãƒªã‚¢
                const victoryMsg = this.gameArea.querySelector('.victory-message');
                if (victoryMsg) {
                    victoryMsg.parentNode.removeChild(victoryMsg);
                }
            }
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            new MultitaskGame();
        });

        function goBack() {
            window.history.back();
        }
    </script>
</body>
</html>