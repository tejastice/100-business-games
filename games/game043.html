<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è«–ç†ãƒ‘ã‚ºãƒ« - ã‚²ãƒ¼ãƒ 043</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .game-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            max-width: 900px;
            width: 95%;
            text-align: center;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
            max-height: 90vh;
            overflow-y: auto;
        }

        .game-title {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .game-description {
            font-size: 1.2rem;
            margin-bottom: 30px;
            opacity: 0.9;
        }

        .game-stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .stat {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px 25px;
            border-radius: 15px;
            min-width: 120px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
        }

        .game-area {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            min-height: 500px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .logic-problem {
            background: rgba(255, 255, 255, 0.2);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: left;
            max-width: 100%;
            line-height: 1.6;
        }

        .logic-problem h3 {
            color: #fff;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .conditions-list {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .condition-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 15px;
            margin: 8px 0;
            border-radius: 8px;
            border-left: 4px solid #4caf50;
            font-size: 0.95rem;
        }

        .reasoning-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .reasoning-step {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .reasoning-step:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        .reasoning-step.selected {
            border-color: #4caf50;
            background: rgba(76, 175, 80, 0.3);
        }

        .reasoning-step.incorrect {
            border-color: #f44336;
            background: rgba(244, 67, 54, 0.3);
        }

        .reasoning-step.correct {
            border-color: #4caf50;
            background: rgba(76, 175, 80, 0.4);
        }

        .answer-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .answer-option {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.5);
            color: white;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: bold;
        }

        .answer-option:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .answer-option.selected {
            background: rgba(76, 175, 80, 0.6);
            border-color: #4caf50;
        }

        .answer-option.correct {
            background: rgba(76, 175, 80, 0.8);
            border-color: #4caf50;
        }

        .answer-option.incorrect {
            background: rgba(244, 67, 54, 0.6);
            border-color: #f44336;
        }

        .contradiction-detector {
            background: rgba(255, 193, 7, 0.2);
            border: 2px solid #ffc107;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            display: none;
        }

        .contradiction-detector.active {
            display: block;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.2);
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .instructions {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            text-align: left;
        }

        .game-over {
            background: rgba(76, 175, 80, 0.2);
            border: 2px solid #4caf50;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            display: none;
        }

        .deduction-chain {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #2196f3;
        }

        @media (max-width: 768px) {
            .game-container {
                padding: 20px;
                margin: 10px;
            }
            
            .game-title {
                font-size: 2rem;
            }
            
            .game-stats {
                flex-direction: column;
                align-items: center;
            }
            
            .stat {
                min-width: 200px;
            }
        }
    </style>
</head>
<body>
    <button class="back-btn" onclick="goBack()">â† ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>

    <div class="game-container">
        <h1 class="game-title">ğŸ§  è«–ç†ãƒ‘ã‚ºãƒ«</h1>
        <p class="game-description">æ¡ä»¶æ¨ç†ã¨è«–ç†çš„æ¼”ç¹¹ã«ã‚ˆã‚‹é«˜åº¦ãªè«–ç†æ€è€ƒèƒ½åŠ›å‘ä¸Šã‚²ãƒ¼ãƒ </p>

        <div class="game-stats">
            <div class="stat">
                <div class="stat-label">ç¾åœ¨ã®å•é¡Œ</div>
                <div class="stat-value" id="currentProblem">1</div>
            </div>
            <div class="stat">
                <div class="stat-label">æ­£è§£ç‡</div>
                <div class="stat-value" id="accuracy">0%</div>
            </div>
            <div class="stat">
                <div class="stat-label">æ¨ç†ã‚¹ãƒ†ãƒƒãƒ—</div>
                <div class="stat-value" id="reasoningSteps">0</div>
            </div>
            <div class="stat">
                <div class="stat-label">æ™‚é–“</div>
                <div class="stat-value" id="timer">0:00</div>
            </div>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
        </div>

        <div class="game-area">
            <div class="logic-problem" id="logicProblem">
                <h3>å•é¡Œã‚’èª­ã¿è¾¼ã¿ä¸­...</h3>
            </div>

            <div class="conditions-list" id="conditionsList">
                <!-- æ¡ä»¶ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
            </div>

            <div class="reasoning-grid" id="reasoningGrid">
                <!-- æ¨ç†ã‚¹ãƒ†ãƒƒãƒ—ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
            </div>

            <div class="contradiction-detector" id="contradictionDetector">
                <h4>âš ï¸ çŸ›ç›¾æ¤œå‡º</h4>
                <p id="contradictionMessage"></p>
            </div>

            <div class="answer-options" id="answerOptions">
                <!-- ç­”ãˆã®é¸æŠè‚¢ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
            </div>

            <div class="deduction-chain" id="deductionChain" style="display: none;">
                <h4>ğŸ”— æ¨ç†ã®é€£é–</h4>
                <div id="deductionSteps"></div>
            </div>
        </div>

        <div class="game-over" id="gameOver">
            <h2 id="gameOverTitle">ğŸ‰ ã‚²ãƒ¼ãƒ å®Œäº†ï¼</h2>
            <p>ç·åˆæ­£è§£ç‡: <span id="finalAccuracy">0%</span></p>
            <p>æ¨ç†åŠ¹ç‡: <span id="reasoningEfficiency">0%</span></p>
            <p>è«–ç†æ€è€ƒåŠ›: <span id="logicalThinking">0%</span></p>
            <p>çŸ›ç›¾æ¤œå‡ºèƒ½åŠ›: <span id="contradictionDetection">0%</span></p>
        </div>

        <div class="controls">
            <button class="btn" id="startBtn" onclick="startGame()">æ–°ã—ã„å•é¡Œã‚»ãƒƒãƒˆ</button>
            <button class="btn" id="nextBtn" onclick="nextProblem()" disabled>æ¬¡ã®å•é¡Œ</button>
            <button class="btn" id="hintBtn" onclick="showHint()">ãƒ’ãƒ³ãƒˆ</button>
            <button class="btn" onclick="goBack()">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>
        </div>

        <div class="instructions">
            <h3>ğŸ¯ è©³ç´°ãƒ«ãƒ¼ãƒ«ãƒ»éŠã³æ–¹</h3>
            <p><strong>ç›®çš„:</strong> ä¸ãˆã‚‰ã‚ŒãŸè«–ç†æ¡ä»¶ã‹ã‚‰æ­£ã—ã„çµè«–ã‚’å°ãå‡ºã™</p>
            <p><strong>ã‚²ãƒ¼ãƒ ã®æµã‚Œ:</strong></p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>10å•ã®è«–ç†å•é¡Œã‚’è§£ã</li>
                <li>å„å•é¡Œã«è¤‡æ•°ã®æ¡ä»¶ãŒä¸ãˆã‚‰ã‚Œã‚‹</li>
                <li>æ¡ä»¶ã‚’åˆ†æã—ã¦æ­£ã—ã„æ¨ç†ã‚¹ãƒ†ãƒƒãƒ—ã‚’é¸æŠ</li>
                <li>çŸ›ç›¾ã‚’æ¤œå‡ºã—ã¦æ’é™¤</li>
                <li>æœ€çµ‚çš„ãªçµè«–ã‚’é¸æŠ</li>
            </ul>
            <p><strong>è©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ :</strong></p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>æ­£è§£ç‡: æ­£ã—ã„çµè«–ã‚’å°ã„ãŸå‰²åˆ</li>
                <li>æ¨ç†åŠ¹ç‡: æœ€å°ã‚¹ãƒ†ãƒƒãƒ—ã§ã®è§£æ±ºèƒ½åŠ›</li>
                <li>çŸ›ç›¾æ¤œå‡º: è«–ç†çš„çŸ›ç›¾ã‚’è¦‹ã¤ã‘ã‚‹èƒ½åŠ›</li>
                <li>è«–ç†çš„ä¸€è²«æ€§: æ¨ç†ãƒ—ãƒ­ã‚»ã‚¹ã®ä¸€è²«æ€§</li>
            </ul>
            <p><strong>ã‚¯ãƒªã‚¢æ¡ä»¶:</strong> æ­£è§£ç‡85%ä»¥ä¸Š</p>
            <p><strong>æ“ä½œæ–¹æ³•:</strong></p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>æ¨ç†ã‚¹ãƒ†ãƒƒãƒ—ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ</li>
                <li>çŸ›ç›¾ã‚’ç™ºè¦‹ã—ãŸã‚‰è©²å½“éƒ¨åˆ†ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
                <li>æœ€çµ‚å›ç­”ã‚’é¸æŠè‚¢ã‹ã‚‰é¸ã¶</li>
                <li>ãƒ’ãƒ³ãƒˆãƒœã‚¿ãƒ³ã§æ¨ç†ã®æ–¹å‘æ€§ã‚’ç¢ºèª</li>
            </ul>
            <p><strong>ãƒ—ãƒ¬ã‚¤ã®ã‚³ãƒ„:</strong></p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>å…¨ã¦ã®æ¡ä»¶ã‚’æ³¨æ„æ·±ãèª­ã‚€</li>
                <li>çŸ›ç›¾ã™ã‚‹æ¡ä»¶ãŒãªã„ã‹ç¢ºèª</li>
                <li>æ®µéšçš„ã«æ¨ç†ã‚’é€²ã‚ã‚‹</li>
                <li>çµè«–ã«è‡³ã‚‹ã¾ã§ã®è«–ç†çš„çµŒè·¯ã‚’ç¢ºèª</li>
            </ul>
        </div>
    </div>

    <script>
        let gameState = {
            currentProblem: 0,
            totalProblems: 10,
            correctAnswers: 0,
            reasoningSteps: 0,
            startTime: null,
            problems: [],
            selectedSteps: [],
            isGameActive: false,
            contradictionsFound: 0,
            hintsUsed: 0
        };

        const logicProblems = [
            {
                id: 1,
                title: "ä¼šè­°å®¤ã®åº§å¸­é…ç½®",
                description: "5äººã®ç¤¾å“¡Aã€Bã€Cã€Dã€EãŒå††å½¢ãƒ†ãƒ¼ãƒ–ãƒ«ã§ä¼šè­°ã‚’è¡Œã„ã¾ã™ã€‚ä»¥ä¸‹ã®æ¡ä»¶ã‚’æº€ãŸã™åº§å¸­é…ç½®ã‚’æ¨ç†ã—ã¦ãã ã•ã„ã€‚",
                conditions: [
                    "Aã¯å¿…ãšBã®å·¦éš£ã«åº§ã‚‹",
                    "Cã¯Dã®å‘ã‹ã„å´ã«åº§ã‚‹",
                    "Eã¯Aã®å³éš£ã«ã¯åº§ã‚‰ãªã„", 
                    "Bã¨Cã¯éš£ã‚Šåˆã‚ãªã„",
                    "Dã¯å¿…ãšEã®å·¦éš£ã«åº§ã‚‹"
                ],
                correctAnswer: "A-B-E-D-C ã®é †ã§å††å½¢ã«é…ç½®",
                options: [
                    "A-B-C-D-E ã®é †ã§å††å½¢ã«é…ç½®",
                    "A-B-E-D-C ã®é †ã§å††å½¢ã«é…ç½®", 
                    "A-C-B-D-E ã®é †ã§å††å½¢ã«é…ç½®",
                    "æ¡ä»¶ã‚’æº€ãŸã™é…ç½®ã¯å­˜åœ¨ã—ãªã„"
                ],
                correctIndex: 1,
                reasoningSteps: [
                    "æ¡ä»¶1ã‹ã‚‰Aã¨Bã¯éš£æ¥ã™ã‚‹",
                    "æ¡ä»¶2ã‹ã‚‰Cã¨Dã¯å‘ã‹ã„åˆã†",
                    "æ¡ä»¶4ã‹ã‚‰Bã¨Cã¯éš£æ¥ã—ãªã„",
                    "æ¡ä»¶5ã‹ã‚‰Dã¨Eã¯éš£æ¥ã—ã€DãŒEã®å·¦å´",
                    "æ¡ä»¶3ã‹ã‚‰Eã¯Aã®å³éš£ã§ã¯ãªã„"
                ]
            },
            {
                id: 2,
                title: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒãƒ¼ãƒ ã®ç·¨æˆ",
                description: "6äººã®ç¤¾å“¡ã‚’3ã¤ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒãƒ¼ãƒ ï¼ˆå„2äººï¼‰ã«åˆ†ã‘ã‚‹éš›ã®è«–ç†çš„æ¨ç†å•é¡Œã§ã™ã€‚",
                conditions: [
                    "ç”°ä¸­ã•ã‚“ã¯å¿…ãšéˆ´æœ¨ã•ã‚“ã¨åŒã˜ãƒãƒ¼ãƒ ã«ãªã‚‹",
                    "ä½è—¤ã•ã‚“ã¯é«˜æ©‹ã•ã‚“ã¨åŒã˜ãƒãƒ¼ãƒ ã«ã¯ãªã‚‰ãªã„",
                    "å±±ç”°ã•ã‚“ã¯ç”°ä¸­ã•ã‚“ã¨åŒã˜ãƒãƒ¼ãƒ ã«ã¯ãªã‚‰ãªã„",
                    "éˆ´æœ¨ã•ã‚“ã¯ä½è—¤ã•ã‚“ã¨åŒã˜ãƒãƒ¼ãƒ ã«ã¯ãªã‚‰ãªã„",
                    "é«˜æ©‹ã•ã‚“ã¯å±±ç”°ã•ã‚“ã¨åŒã˜ãƒãƒ¼ãƒ ã«ãªã‚‹"
                ],
                correctAnswer: "ãƒãƒ¼ãƒ 1:ç”°ä¸­ãƒ»éˆ´æœ¨ã€ãƒãƒ¼ãƒ 2:é«˜æ©‹ãƒ»å±±ç”°ã€ãƒãƒ¼ãƒ 3:ä½è—¤ãƒ»æ®‹ã‚Š1äºº",
                options: [
                    "ãƒãƒ¼ãƒ 1:ç”°ä¸­ãƒ»éˆ´æœ¨ã€ãƒãƒ¼ãƒ 2:é«˜æ©‹ãƒ»å±±ç”°ã€ãƒãƒ¼ãƒ 3:ä½è—¤ãƒ»æ®‹ã‚Š1äºº",
                    "ãƒãƒ¼ãƒ 1:ç”°ä¸­ãƒ»ä½è—¤ã€ãƒãƒ¼ãƒ 2:éˆ´æœ¨ãƒ»é«˜æ©‹ã€ãƒãƒ¼ãƒ 3:å±±ç”°ãƒ»æ®‹ã‚Š1äºº",
                    "ãƒãƒ¼ãƒ 1:ç”°ä¸­ãƒ»å±±ç”°ã€ãƒãƒ¼ãƒ 2:éˆ´æœ¨ãƒ»ä½è—¤ã€ãƒãƒ¼ãƒ 3:é«˜æ©‹ãƒ»æ®‹ã‚Š1äºº",
                    "æ¡ä»¶ã‚’æº€ãŸã™ç·¨æˆã¯è¤‡æ•°å­˜åœ¨ã™ã‚‹"
                ],
                correctIndex: 0,
                reasoningSteps: [
                    "æ¡ä»¶1ã‹ã‚‰ç”°ä¸­ã¨éˆ´æœ¨ã¯åŒã˜ãƒãƒ¼ãƒ ",
                    "æ¡ä»¶3ã‹ã‚‰å±±ç”°ã¯ç”°ä¸­ã¨åŒã˜ãƒãƒ¼ãƒ ã«ãªã‚‰ãªã„",
                    "æ¡ä»¶4ã‹ã‚‰éˆ´æœ¨ã¯ä½è—¤ã¨åŒã˜ãƒãƒ¼ãƒ ã«ãªã‚‰ãªã„",
                    "æ¡ä»¶5ã‹ã‚‰é«˜æ©‹ã¨å±±ç”°ã¯åŒã˜ãƒãƒ¼ãƒ ",
                    "æ¡ä»¶2ã‹ã‚‰ä½è—¤ã¯é«˜æ©‹ã¨åŒã˜ãƒãƒ¼ãƒ ã«ãªã‚‰ãªã„"
                ]
            },
            {
                id: 3,
                title: "å–¶æ¥­æˆç¸¾ã®é †ä½æ¨ç†",
                description: "5äººã®å–¶æ¥­å“¡ã®ä»Šæœˆã®å£²ä¸Šé †ä½ã‚’è«–ç†çš„ã«æ¨ç†ã—ã¦ãã ã•ã„ã€‚",
                conditions: [
                    "Aã®å£²ä¸Šã¯Bã‚ˆã‚Šå¤šã„",
                    "Cã¯Dã‚ˆã‚Šå£²ä¸ŠãŒå°‘ãªã„",
                    "Eã¯Aã‚ˆã‚Šå£²ä¸ŠãŒå¤šã„",
                    "Bã¯Cã‚ˆã‚Šå£²ä¸ŠãŒå°‘ãªã„",
                    "Dã¯Eã‚ˆã‚Šå£²ä¸ŠãŒå°‘ãªã„"
                ],
                correctAnswer: "E > A > B > C > D (é™é †)",
                options: [
                    "A > B > C > D > E (é™é †)",
                    "E > A > B > C > D (é™é †)",
                    "D > C > B > A > E (é™é †)",
                    "E > D > C > B > A (é™é †)"
                ],
                correctIndex: 1,
                reasoningSteps: [
                    "æ¡ä»¶1: A > B",
                    "æ¡ä»¶2: D > C", 
                    "æ¡ä»¶3: E > A",
                    "æ¡ä»¶4: C > B",
                    "æ¡ä»¶5: E > D"
                ]
            }
        ];

        function startGame() {
            gameState.currentProblem = 0;
            gameState.correctAnswers = 0;
            gameState.reasoningSteps = 0;
            gameState.contradictionsFound = 0;
            gameState.hintsUsed = 0;
            gameState.selectedSteps = [];
            gameState.isGameActive = true;
            gameState.startTime = Date.now();
            gameState.problems = [...logicProblems];
            
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('startBtn').disabled = true;
            document.getElementById('nextBtn').disabled = false;
            
            loadProblem();
            startTimer();
        }

        function loadProblem() {
            if (gameState.currentProblem >= gameState.totalProblems || 
                gameState.currentProblem >= gameState.problems.length) {
                endGame();
                return;
            }

            const problem = gameState.problems[gameState.currentProblem];
            
            // å•é¡Œè¡¨ç¤º
            document.getElementById('logicProblem').innerHTML = `
                <h3>å•é¡Œ ${gameState.currentProblem + 1}: ${problem.title}</h3>
                <p>${problem.description}</p>
            `;

            // æ¡ä»¶è¡¨ç¤º
            const conditionsList = document.getElementById('conditionsList');
            conditionsList.innerHTML = '<h4>ğŸ“‹ è«–ç†æ¡ä»¶</h4>' + 
                problem.conditions.map((condition, index) => 
                    `<div class="condition-item">æ¡ä»¶${index + 1}: ${condition}</div>`
                ).join('');

            // æ¨ç†ã‚¹ãƒ†ãƒƒãƒ—è¡¨ç¤º
            const reasoningGrid = document.getElementById('reasoningGrid');
            reasoningGrid.innerHTML = '<h4>ğŸ” æ¨ç†ã‚¹ãƒ†ãƒƒãƒ— (é †ç•ªã«ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„)</h4>' +
                problem.reasoningSteps.map((step, index) => 
                    `<div class="reasoning-step" onclick="selectReasoningStep(${index})" id="step-${index}">
                        ${step}
                    </div>`
                ).join('');

            // å›ç­”é¸æŠè‚¢è¡¨ç¤º
            const answerOptions = document.getElementById('answerOptions');
            answerOptions.innerHTML = '<h4>ğŸ’¡ çµè«–ã‚’é¸æŠã—ã¦ãã ã•ã„</h4>' +
                problem.options.map((option, index) => 
                    `<div class="answer-option" onclick="selectAnswer(${index})" id="option-${index}">
                        ${option}
                    </div>`
                ).join('');

            // æ¨ç†ã®é€£é–ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('deductionChain').style.display = 'none';
            document.getElementById('contradictionDetector').classList.remove('active');
            
            gameState.selectedSteps = [];
            updateProgress();
        }

        function selectReasoningStep(stepIndex) {
            const step = document.getElementById(`step-${stepIndex}`);
            
            if (gameState.selectedSteps.includes(stepIndex)) {
                return; // æ—¢ã«é¸æŠæ¸ˆã¿
            }

            gameState.selectedSteps.push(stepIndex);
            gameState.reasoningSteps++;
            
            step.classList.add('selected');
            
            // æ¨ç†ã®é€£é–ã‚’è¡¨ç¤º
            updateDeductionChain();
            
            // çŸ›ç›¾ãƒã‚§ãƒƒã‚¯
            checkContradictions();
            
            updateStats();
        }

        function selectAnswer(answerIndex) {
            const problem = gameState.problems[gameState.currentProblem];
            const options = document.querySelectorAll('.answer-option');
            
            // å…¨ã¦ã®é¸æŠè‚¢ã‚’ç„¡åŠ¹åŒ–
            options.forEach(option => {
                option.style.pointerEvents = 'none';
            });
            
            // é¸æŠã—ãŸé¸æŠè‚¢ã‚’ãƒãƒ¼ã‚¯
            const selectedOption = document.getElementById(`option-${answerIndex}`);
            selectedOption.classList.add('selected');
            
            // æ­£è§£ãƒã‚§ãƒƒã‚¯
            setTimeout(() => {
                if (answerIndex === problem.correctIndex) {
                    selectedOption.classList.add('correct');
                    selectedOption.classList.remove('selected');
                    gameState.correctAnswers++;
                    
                    // å…¨ã¦ã®æ¨ç†ã‚¹ãƒ†ãƒƒãƒ—ã‚’æ­£è§£ãƒãƒ¼ã‚¯
                    gameState.selectedSteps.forEach(stepIndex => {
                        document.getElementById(`step-${stepIndex}`).classList.add('correct');
                    });
                } else {
                    selectedOption.classList.add('incorrect');
                    selectedOption.classList.remove('selected');
                    
                    // æ­£è§£ã‚’è¡¨ç¤º
                    const correctOption = document.getElementById(`option-${problem.correctIndex}`);
                    correctOption.classList.add('correct');
                    
                    // é–“é•ã£ãŸæ¨ç†ã‚¹ãƒ†ãƒƒãƒ—ã‚’ãƒãƒ¼ã‚¯
                    gameState.selectedSteps.forEach(stepIndex => {
                        document.getElementById(`step-${stepIndex}`).classList.add('incorrect');
                    });
                }
                
                updateStats();
                
                // æ¬¡ã®å•é¡Œã¸ã®ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
                setTimeout(() => {
                    gameState.currentProblem++;
                    if (gameState.currentProblem < gameState.totalProblems && 
                        gameState.currentProblem < gameState.problems.length) {
                        document.getElementById('nextBtn').disabled = false;
                    } else {
                        endGame();
                    }
                }, 1500);
            }, 500);
        }

        function nextProblem() {
            document.getElementById('nextBtn').disabled = true;
            loadProblem();
        }

        function updateDeductionChain() {
            const problem = gameState.problems[gameState.currentProblem];
            const deductionChain = document.getElementById('deductionChain');
            const deductionSteps = document.getElementById('deductionSteps');
            
            if (gameState.selectedSteps.length > 0) {
                deductionChain.style.display = 'block';
                deductionSteps.innerHTML = gameState.selectedSteps.map((stepIndex, index) => 
                    `<div style="margin: 5px 0; padding: 8px; background: rgba(255,255,255,0.1); border-radius: 5px;">
                        ${index + 1}. ${problem.reasoningSteps[stepIndex]}
                    </div>`
                ).join('');
            }
        }

        function checkContradictions() {
            const detector = document.getElementById('contradictionDetector');
            const message = document.getElementById('contradictionMessage');
            
            // ç°¡å˜ãªçŸ›ç›¾ãƒã‚§ãƒƒã‚¯ä¾‹ï¼ˆå®Ÿéš›ã®å®Ÿè£…ã§ã¯æ¡ä»¶ã«å¿œã˜ã¦åˆ¤å®šï¼‰
            if (gameState.selectedSteps.length >= 3) {
                const hasContradiction = Math.random() < 0.1; // 10%ã®ç¢ºç‡ã§çŸ›ç›¾ã‚’æ¤œå‡º
                
                if (hasContradiction) {
                    detector.classList.add('active');
                    message.textContent = 'é¸æŠã—ãŸæ¨ç†ã‚¹ãƒ†ãƒƒãƒ—ã«è«–ç†çš„çŸ›ç›¾ãŒå«ã¾ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚';
                    gameState.contradictionsFound++;
                }
            }
        }

        function showHint() {
            const problem = gameState.problems[gameState.currentProblem];
            const hintMessages = [
                'å…¨ã¦ã®æ¡ä»¶ã‚’åŒæ™‚ã«æº€ãŸã™è§£ã‚’æ¢ã—ã¦ãã ã•ã„ã€‚',
                'çŸ›ç›¾ã™ã‚‹æ¡ä»¶ãŒãªã„ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚',
                'ä¸€ã¤ãšã¤æ¡ä»¶ã‚’é©ç”¨ã—ã¦å¯èƒ½æ€§ã‚’çµã‚Šè¾¼ã‚“ã§ãã ã•ã„ã€‚',
                'æ—¢ã«é¸æŠã—ãŸæ¨ç†ã‚¹ãƒ†ãƒƒãƒ—ã®è«–ç†çš„ã¤ãªãŒã‚Šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚'
            ];
            
            const hint = hintMessages[gameState.hintsUsed % hintMessages.length];
            gameState.hintsUsed++;
            
            alert('ğŸ’¡ ãƒ’ãƒ³ãƒˆ: ' + hint);
            updateStats();
        }

        function updateStats() {
            document.getElementById('currentProblem').textContent = Math.min(gameState.currentProblem + 1, gameState.totalProblems);
            document.getElementById('accuracy').textContent = 
                gameState.currentProblem > 0 ? 
                Math.round((gameState.correctAnswers / gameState.currentProblem) * 100) + '%' : '0%';
            document.getElementById('reasoningSteps').textContent = gameState.reasoningSteps;
        }

        function updateProgress() {
            const progress = (gameState.currentProblem / gameState.totalProblems) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function startTimer() {
            setInterval(() => {
                if (gameState.isGameActive) {
                    const elapsed = Math.floor((Date.now() - gameState.startTime) / 1000);
                    const minutes = Math.floor(elapsed / 60);
                    const seconds = elapsed % 60;
                    document.getElementById('timer').textContent = 
                        `${minutes}:${seconds.toString().padStart(2, '0')}`;
                }
            }, 1000);
        }

        function endGame() {
            gameState.isGameActive = false;
            
            const accuracy = Math.round((gameState.correctAnswers / gameState.totalProblems) * 100);
            const reasoningEfficiency = Math.max(0, 100 - (gameState.reasoningSteps - gameState.totalProblems * 3) * 5);
            const logicalThinking = Math.round((accuracy + reasoningEfficiency) / 2);
            const contradictionDetection = Math.min(100, gameState.contradictionsFound * 20);
            
            document.getElementById('finalAccuracy').textContent = accuracy + '%';
            document.getElementById('reasoningEfficiency').textContent = reasoningEfficiency + '%';
            document.getElementById('logicalThinking').textContent = logicalThinking + '%';
            document.getElementById('contradictionDetection').textContent = contradictionDetection + '%';
            
            const gameOverDiv = document.getElementById('gameOver');
            const gameOverTitle = document.getElementById('gameOverTitle');
            
            if (accuracy >= 85) {
                gameOverTitle.innerHTML = 'ğŸ‰ å„ªç§€ãªè«–ç†æ€è€ƒåŠ›ï¼';
                gameOverDiv.style.borderColor = '#4caf50';
                gameOverDiv.style.background = 'rgba(76, 175, 80, 0.2)';
            } else if (accuracy >= 70) {
                gameOverTitle.innerHTML = 'ğŸ‘ è‰¯å¥½ãªè«–ç†æ€è€ƒåŠ›';
                gameOverDiv.style.borderColor = '#ff9800';
                gameOverDiv.style.background = 'rgba(255, 152, 0, 0.2)';
            } else {
                gameOverTitle.innerHTML = 'ğŸ“š è«–ç†æ€è€ƒåŠ›ã‚’å‘ä¸Šã•ã›ã¾ã—ã‚‡ã†';
                gameOverDiv.style.borderColor = '#f44336';
                gameOverDiv.style.background = 'rgba(244, 67, 54, 0.2)';
            }
            
            gameOverDiv.style.display = 'block';
            document.getElementById('startBtn').disabled = false;
            document.getElementById('nextBtn').disabled = true;
            
            updateProgress();
        }

        function goBack() {
            window.location.href = '../index.html';
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateStats();
            updateProgress();
        });
    </script>
</body>
</html>