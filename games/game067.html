<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ˜ã‚Šç´™ãƒ‘ã‚ºãƒ« - ã‚²ãƒ¼ãƒ 067</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .game-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            max-width: 800px;
            width: 90%;
            text-align: center;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
        }

        .game-title {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .game-description {
            font-size: 1.2rem;
            margin-bottom: 30px;
            opacity: 0.9;
        }

        .game-stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .stat {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px 25px;
            border-radius: 15px;
            min-width: 100px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
        }

        .game-area {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 40px;
            margin-bottom: 30px;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .origami-workspace {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 100%;
        }

        .current-work {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }

        .current-work h4 {
            color: #ffc107;
            margin-bottom: 15px;
        }

        .work-info {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            text-align: center;
        }

        .info-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .step-controls {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 15px;
        }

        .step-controls h4 {
            color: #ffc107;
            margin-bottom: 10px;
            text-align: center;
        }

        .step-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .step-btn {
            background: rgba(255, 255, 255, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.5);
            color: white;
            padding: 12px 16px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 0.9rem;
        }

        .step-btn:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: translateY(-2px);
        }

        .step-btn.completed {
            background: rgba(76, 175, 80, 0.7);
            border-color: #4caf50;
        }

        .step-btn.current {
            background: rgba(255, 193, 7, 0.7);
            border-color: #ffc107;
        }

        .completion-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 10px;
            margin-top: 15px;
            text-align: center;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .instructions {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: left;
            flex-shrink: 0;
        }

        .instructions h4 {
            color: #ffc107;
            margin-bottom: 10px;
        }

        .instructions ul {
            margin-left: 20px;
        }

        .instructions li {
            margin: 5px 0;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            margin: 15px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        @media (max-width: 768px) {
            .logic-grid {
                grid-template-columns: repeat(4, 50px);
            }
            .grid-cell {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <button class="back-btn" onclick="goBack()">â† ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>

    <div class="game-container">
        <h1 class="game-title">ğŸ“œ æŠ˜ã‚Šç´™ãƒ‘ã‚ºãƒ«</h1>
        <p class="game-description">ç´™ã®æŠ˜ã‚Šæ–¹ç†è§£ã¨æ‰‹é †è¨˜æ†¶ã«ã‚ˆã‚‹ç²¾å¯†ä½œæ¥­æŠ€èƒ½ã‚²ãƒ¼ãƒ </p>

        <div class="game-stats">
            <div class="stat">
                <div class="stat-label">ä½œå“</div>
                <div class="stat-value" id="currentWork">1</div>
            </div>
            <div class="stat">
                <div class="stat-label">å®Œæˆæ•°</div>
                <div class="stat-value" id="completedWorks">0</div>
            </div>
            <div class="stat">
                <div class="stat-label">å®Œæˆç‡</div>
                <div class="stat-value" id="completionRate">0%</div>
            </div>
            <div class="stat">
                <div class="stat-label">ã‚¹ã‚³ã‚¢</div>
                <div class="stat-value" id="score">0</div>
            </div>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="instructions">
            <h4>ğŸ“‹ è©³ç´°ãƒ«ãƒ¼ãƒ«ãƒ»éŠã³æ–¹</h4>
            <ul>
                <li><strong>ç›®çš„:</strong> 15ç¨®é¡ã®æŠ˜ã‚Šç´™ä½œå“ã‚’æ­£ç¢ºãªæ‰‹é †ã§æŠ˜ã‚Šã€å®Œæˆå½¢çŠ¶ã‚’é”æˆã™ã‚‹</li>
                <li><strong>ã‚²ãƒ¼ãƒ ã®æµã‚Œ:</strong>
                    <ul>
                        <li>æŠ˜ã‚Šç´™ä½œå“ã®ç›®æ¨™å½¢çŠ¶ãŒæç¤ºã•ã‚Œã‚‹</li>
                        <li>æŠ˜ã‚Šæ‰‹é †ã‚’é †åºã‚ˆãå®Ÿè¡Œã—ã€æ­£ç¢ºãªæŠ˜ã‚Šç·šã‚’ä½œã‚‹</li>
                        <li>æ‰‹é †ã®æ­£ç¢ºæ€§ã¨å®Œæˆåº¦ã‚’è©•ä¾¡ã•ã‚Œã‚‹</li>
                    </ul>
                </li>
                <li><strong>æŠ˜ã‚Šç´™ä½œå“:</strong> é¶´ã€ã‹ã¶ã¨ã€èŠ±ã€æ˜Ÿã€å‹•ç‰©ãªã©å¤šç¨®å¤šæ§˜ãªä½œå“</li>
                <li><strong>å‹åˆ©æ¡ä»¶:</strong> 15ä½œå“ä¸­ã€å®Œæˆç…90%ä»¥ä¸Šï¼ˆ14ä½œå“ä»¥ä¸Šå®Œæˆï¼‰ã§ã‚¯ãƒªã‚¢</li>
                <li><strong>è©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ :</strong> æ­£ç¢ºãªæŠ˜ã‚Š: +100ç‚¹ã€éƒ¨åˆ†å®Œæˆ: +50ç‚¹ã€æŠ˜ã‚ŠãƒŸã‚¹: -25ç‚¹</li>
                <li><strong>ãƒ—ãƒ¬ã‚¤ã®ã‚³ãƒ„:</strong> æŠ˜ã‚Šç·šã®ç²¾åº¦ã¨æ‰‹é †ã®æ­£ç¢ºæ€§ã‚’æ„è­˜ã—ã€ç´°ã‹ã„ä½œæ¥­ã«é›†ä¸­ã™ã‚‹</li>
            </ul>
        </div>

        <div class="game-area">
            <div class="origami-workspace" id="origamiWorkspace">
                <div class="current-work">
                    <h4>ğŸ“œ ç¾åœ¨ã®ä½œå“</h4>
                    <div class="work-info" id="workInfo">
                        <!-- ä½œå“æƒ…å ±ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                    </div>
                    <canvas id="origamiCanvas" width="400" height="300" style="border: 2px solid #fff; border-radius: 10px; background: rgba(255,255,255,0.9); margin: 15px 0;"></canvas>
                </div>
                
                <div class="step-controls">
                    <h4>ğŸ”„ æŠ˜ã‚Šæ‰‹é †</h4>
                    <div class="step-buttons" id="stepButtons">
                        <!-- æ‰‹é †ãƒœã‚¿ãƒ³ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                    </div>
                </div>
            </div>
        </div>

        <div class="controls">
            <button class="btn" onclick="newOrigamiWork()">æ–°ã—ã„ä½œå“</button>
            <button class="btn" onclick="checkCompletion()">å®Œæˆãƒã‚§ãƒƒã‚¯</button>
            <button class="btn" onclick="showOrigamiGuide()">æŠ˜ã‚Šæ–¹ã‚¬ã‚¤ãƒ‰</button>
            <button class="btn" onclick="resetOrigami()">ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
    </div>

    <script>
        let gameState = {
            currentWork: 1,
            totalWorks: 15,
            completedWorks: 0,
            score: 0,
            currentOrigami: null,
            currentStep: 0,
            foldingSteps: [],
            canvas: null,
            ctx: null
        };

        const origamiWorks = [
            { name: 'é¶´', steps: ['å››è§’æŠ˜ã‚Š', 'ä¸‰è§’æŠ˜ã‚Š', 'ç¾½æŠ˜ã‚Š', 'é¦–æŠ˜ã‚Š', 'å°¾æŠ˜ã‚Š'], difficulty: 'normal', color: '#e91e63' },
            { name: 'ã‹ã¶ã¨', steps: ['ä¸‰è§’æŠ˜ã‚Š', 'è§’æŠ˜ã‚Š', 'ã²ã•ã—æŠ˜ã‚Š', 'å®Œæˆ'], difficulty: 'easy', color: '#3f51b5' },
            { name: 'èŠ±', steps: ['å››è§’æŠ˜ã‚Š', 'èŠ±ã³ã‚‰1', 'èŠ±ã³ã‚‰2', 'èŠ±ã³ã‚‰3', 'èŠ±ã³ã‚‰4'], difficulty: 'normal', color: '#e91e63' },
            { name: 'æ˜Ÿ', steps: ['äº”è§’æŠ˜ã‚Š', 'æ˜Ÿè§’1', 'æ˜Ÿè§’2', 'æ˜Ÿè§’3', 'æ˜Ÿè§’4', 'æ˜Ÿè§’5'], difficulty: 'hard', color: '#ff9800' },
            { name: 'è¶', steps: ['ä¸‰è§’æŠ˜ã‚Š', 'ç¾½æº–å‚™', 'å·¦ç¾½', 'å³ç¾½', 'èƒ´ä½“'], difficulty: 'normal', color: '#9c27b0' },
            { name: 'ãƒãƒ©', steps: ['åŸºæœ¬æŠ˜ã‚Š', 'èŠ±ã³ã‚‰æº–å‚™', 'å¤–å´èŠ±ã³ã‚‰', 'å†…å´èŠ±ã³ã‚‰', 'èŠ±å®Œæˆ'], difficulty: 'expert', color: '#f44336' },
            { name: 'çŠ¬', steps: ['ä¸‰è§’æŠ˜ã‚Š', 'è€³æŠ˜ã‚Š1', 'è€³æŠ˜ã‚Š2', 'é¡”å½¢æˆ', 'å®Œæˆ'], difficulty: 'easy', color: '#795548' },
            { name: 'çŒ«', steps: ['å››è§’æŠ˜ã‚Š', 'è€³æŠ˜ã‚Š', 'é¡”å½¢æˆ', 'ã²ã’æŠ˜ã‚Š', 'å®Œæˆ'], difficulty: 'normal', color: '#607d8b' },
            { name: 'é­š', steps: ['ä¸‰è§’æŠ˜ã‚Š', 'èƒ´ä½“æŠ˜ã‚Š', 'å°¾ã²ã‚Œ', 'èƒŒã³ã‚Œ', 'å®Œæˆ'], difficulty: 'normal', color: '#00bcd4' },
            { name: 'é¢¨è»Š', steps: ['å››è§’æŠ˜ã‚Š', 'ç¾½æ ¹1', 'ç¾½æ ¹2', 'ç¾½æ ¹3', 'ç¾½æ ¹4'], difficulty: 'easy', color: '#4caf50' }
        ];

        function initializeGame() {
            gameState.canvas = document.getElementById('origamiCanvas');
            gameState.ctx = gameState.canvas.getContext('2d');
            
            resetGameState();
            generateNewWork();
            updateDisplay();
        }

        function resetGameState() {
            gameState = {
                currentWork: 1,
                totalWorks: 15,
                completedWorks: 0,
                score: 0,
                currentOrigami: null,
                currentStep: 0,
                foldingSteps: [],
                canvas: gameState.canvas,
                ctx: gameState.ctx
            };
        }

        function generateNewWork() {
            if (gameState.currentWork > gameState.totalWorks) {
                endGame();
                return;
            }

            const workIndex = (gameState.currentWork - 1) % origamiWorks.length;
            gameState.currentOrigami = origamiWorks[workIndex];
            gameState.currentStep = 0;
            gameState.foldingSteps = [];
            
            displayWork();
            drawOrigami();
            setupStepButtons();
            updateDisplay();
        }

        function displayWork() {
            const workInfo = document.getElementById('workInfo');
            const origami = gameState.currentOrigami;
            
            workInfo.innerHTML = `
                <div class="info-item">
                    <strong>ä½œå“å:</strong><br>${origami.name}
                </div>
                <div class="info-item">
                    <strong>æ‰‹é †æ•°:</strong><br>${origami.steps.length}ã‚¹ãƒ†ãƒƒãƒ—
                </div>
                <div class="info-item">
                    <strong>é›£æ˜“åº¦:</strong><br>${origami.difficulty}
                </div>
                <div class="info-item">
                    <strong>é€²è¡ŒçŠ¶æ³:</strong><br>${gameState.currentStep}/${origami.steps.length}
                </div>
            `;
        }

        function setupStepButtons() {
            const stepButtons = document.getElementById('stepButtons');
            const origami = gameState.currentOrigami;
            
            stepButtons.innerHTML = '';
            
            origami.steps.forEach((step, index) => {
                const button = document.createElement('div');
                button.className = 'step-btn';
                
                if (index < gameState.currentStep) {
                    button.classList.add('completed');
                } else if (index === gameState.currentStep) {
                    button.classList.add('current');
                }
                
                button.innerHTML = `
                    <div>${index + 1}. ${step}</div>
                    <div style="font-size: 0.8rem; margin-top: 5px;">
                        ${index < gameState.currentStep ? 'âœ“ å®Œäº†' : 
                          index === gameState.currentStep ? 'â†’ å®Ÿè¡Œä¸­' : 'å¾…æ©Ÿä¸­'}
                    </div>
                `;
                
                if (index === gameState.currentStep) {
                    button.onclick = () => executeStep(index);
                }
                
                stepButtons.appendChild(button);
            });
        }

        function executeStep(stepIndex) {
            if (stepIndex !== gameState.currentStep) return;
            
            const origami = gameState.currentOrigami;
            const step = origami.steps[stepIndex];
            
            // æŠ˜ã‚Šæ‰‹é †ã®å®Ÿè¡Œï¼ˆç°¡æ˜“ç‰ˆï¼‰
            const foldAccuracy = Math.random() * 0.4 + 0.6; // 60-100%ã®ç²¾åº¦
            gameState.foldingSteps.push({
                step: step,
                accuracy: foldAccuracy,
                index: stepIndex
            });
            
            gameState.currentStep++;
            
            // ã‚¹ã‚³ã‚¢è¨ˆç®—
            if (foldAccuracy >= 0.9) {
                gameState.score += 100;
            } else if (foldAccuracy >= 0.7) {
                gameState.score += 50;
            } else {
                gameState.score = Math.max(0, gameState.score - 25);
            }
            
            drawOrigami();
            setupStepButtons();
            displayWork();
            updateDisplay();
            
            // ä½œå“å®Œæˆãƒã‚§ãƒƒã‚¯
            if (gameState.currentStep >= origami.steps.length) {
                setTimeout(() => {
                    checkCompletion();
                }, 1000);
            }
        }

        function drawOrigami() {
            gameState.ctx.clearRect(0, 0, gameState.canvas.width, gameState.canvas.height);
            
            const origami = gameState.currentOrigami;
            if (!origami) return;
            
            // èƒŒæ™¯
            gameState.ctx.fillStyle = '#f8f9fa';
            gameState.ctx.fillRect(0, 0, gameState.canvas.width, gameState.canvas.height);
            
            // ç´™ã®åŸºæœ¬å½¢çŠ¶
            const centerX = gameState.canvas.width / 2;
            const centerY = gameState.canvas.height / 2;
            const progress = gameState.currentStep / origami.steps.length;
            
            // æŠ˜ã‚Šç´™ã®é€²è¡ŒçŠ¶æ³ã«å¿œã˜ãŸæç”»
            gameState.ctx.fillStyle = origami.color;
            gameState.ctx.strokeStyle = '#333';
            gameState.ctx.lineWidth = 2;
            
            if (origami.name === 'é¶´') {
                drawCrane(centerX, centerY, progress);
            } else if (origami.name === 'ã‹ã¶ã¨') {
                drawHelmet(centerX, centerY, progress);
            } else if (origami.name === 'èŠ±') {
                drawFlower(centerX, centerY, progress);
            } else {
                drawGenericOrigami(centerX, centerY, progress);
            }
            
            // æŠ˜ã‚Šç·šã®è¡¨ç¤º
            gameState.foldingSteps.forEach((fold, index) => {
                gameState.ctx.strokeStyle = `rgba(255, 0, 0, ${0.3 + fold.accuracy * 0.4})`;
                gameState.ctx.lineWidth = 1;
                gameState.ctx.setLineDash([5, 5]);
                
                // ç°¡æ˜“çš„ãªæŠ˜ã‚Šç·šè¡¨ç¤º
                const x = centerX + (index - gameState.foldingSteps.length/2) * 20;
                gameState.ctx.beginPath();
                gameState.ctx.moveTo(x, centerY - 50);
                gameState.ctx.lineTo(x, centerY + 50);
                gameState.ctx.stroke();
                gameState.ctx.setLineDash([]);
            });
            
            // å®Œæˆåº¦è¡¨ç¤º
            gameState.ctx.fillStyle = '#333';
            gameState.ctx.font = '14px Arial';
            gameState.ctx.textAlign = 'center';
            gameState.ctx.fillText(`å®Œæˆåº¦: ${(progress * 100).toFixed(1)}%`, centerX, 280);
        }

        function drawCrane(x, y, progress) {
            const size = 80 + progress * 40;
            
            // é¶´ã®åŸºæœ¬å½¢çŠ¶
            if (progress > 0.2) {
                // èƒ´ä½“
                gameState.ctx.beginPath();
                gameState.ctx.ellipse(x, y, size * 0.6, size * 0.4, 0, 0, 2 * Math.PI);
                gameState.ctx.fill();
                gameState.ctx.stroke();
            }
            
            if (progress > 0.5) {
                // ç¿¼
                gameState.ctx.beginPath();
                gameState.ctx.moveTo(x - size * 0.8, y);
                gameState.ctx.lineTo(x - size * 0.3, y - size * 0.3);
                gameState.ctx.lineTo(x + size * 0.3, y - size * 0.3);
                gameState.ctx.lineTo(x + size * 0.8, y);
                gameState.ctx.fill();
                gameState.ctx.stroke();
            }
            
            if (progress > 0.8) {
                // é¦–ã¨é ­
                gameState.ctx.beginPath();
                gameState.ctx.moveTo(x, y - size * 0.4);
                gameState.ctx.lineTo(x - size * 0.2, y - size * 0.8);
                gameState.ctx.stroke();
                
                // å°¾
                gameState.ctx.beginPath();
                gameState.ctx.moveTo(x, y + size * 0.4);
                gameState.ctx.lineTo(x + size * 0.3, y + size * 0.7);
                gameState.ctx.stroke();
            }
        }

        function drawHelmet(x, y, progress) {
            const size = 60 + progress * 30;
            
            if (progress > 0.3) {
                // ã‹ã¶ã¨ã®åŸºæœ¬å½¢çŠ¶
                gameState.ctx.beginPath();
                gameState.ctx.moveTo(x - size, y + size * 0.5);
                gameState.ctx.lineTo(x, y - size);
                gameState.ctx.lineTo(x + size, y + size * 0.5);
                gameState.ctx.closePath();
                gameState.ctx.fill();
                gameState.ctx.stroke();
            }
            
            if (progress > 0.7) {
                // ã²ã•ã—
                gameState.ctx.beginPath();
                gameState.ctx.moveTo(x - size * 0.8, y + size * 0.3);
                gameState.ctx.lineTo(x + size * 0.8, y + size * 0.3);
                gameState.ctx.lineTo(x + size * 0.6, y + size * 0.6);
                gameState.ctx.lineTo(x - size * 0.6, y + size * 0.6);
                gameState.ctx.closePath();
                gameState.ctx.fill();
                gameState.ctx.stroke();
            }
        }

        function drawFlower(x, y, progress) {
            const size = 50 + progress * 25;
            const petals = Math.floor(progress * 5) + 1;
            
            for (let i = 0; i < petals; i++) {
                const angle = (i / 5) * 2 * Math.PI;
                const petalX = x + Math.cos(angle) * size * 0.7;
                const petalY = y + Math.sin(angle) * size * 0.7;
                
                gameState.ctx.beginPath();
                gameState.ctx.ellipse(petalX, petalY, size * 0.3, size * 0.5, angle, 0, 2 * Math.PI);
                gameState.ctx.fill();
                gameState.ctx.stroke();
            }
            
            // ä¸­å¿ƒ
            gameState.ctx.fillStyle = '#ffc107';
            gameState.ctx.beginPath();
            gameState.ctx.arc(x, y, size * 0.2, 0, 2 * Math.PI);
            gameState.ctx.fill();
            gameState.ctx.stroke();
        }

        function drawGenericOrigami(x, y, progress) {
            const size = 60 + progress * 40;
            
            // åŸºæœ¬çš„ãªå¤šè§’å½¢
            const sides = 3 + Math.floor(progress * 5);
            gameState.ctx.beginPath();
            for (let i = 0; i < sides; i++) {
                const angle = (i / sides) * 2 * Math.PI;
                const pointX = x + Math.cos(angle) * size;
                const pointY = y + Math.sin(angle) * size;
                
                if (i === 0) {
                    gameState.ctx.moveTo(pointX, pointY);
                } else {
                    gameState.ctx.lineTo(pointX, pointY);
                }
            }
            gameState.ctx.closePath();
            gameState.ctx.fill();
            gameState.ctx.stroke();
        }

        function checkCompletion() {
            const origami = gameState.currentOrigami;
            const totalAccuracy = gameState.foldingSteps.reduce((sum, step) => sum + step.accuracy, 0) / gameState.foldingSteps.length;
            
            let message = `ğŸ“œ ${origami.name}ã®åˆ¶ä½œå®Œäº†ï¼\n\n`;
            message += `æ‰‹é †ç²¾åº¦: ${(totalAccuracy * 100).toFixed(1)}%\n`;
            message += `å®Œæˆã‚¹ãƒ†ãƒƒãƒ—: ${gameState.currentStep}/${origami.steps.length}\n\n`;
            
            if (totalAccuracy >= 0.9) {
                message += 'ğŸ† å®Œç’§ãªæŠ˜ã‚Šç´™ã§ã™ï¼';
                gameState.completedWorks++;
                gameState.score += 200;
            } else if (totalAccuracy >= 0.7) {
                message += 'ğŸ‘ è‰¯ã„å‡ºæ¥ã§ã™ï¼';
                gameState.completedWorks++;
                gameState.score += 100;
            } else {
                message += 'ğŸ“š ã‚‚ã†å°‘ã—ç²¾å¯†ã«æŠ˜ã‚Šã¾ã—ã‚‡ã†ã€‚';
            }
            
            alert(message);
            
            gameState.currentWork++;
            setTimeout(() => {
                generateNewWork();
            }, 1000);
        }

        function showOrigamiGuide() {
            const guides = [
                'ğŸ“œ æŠ˜ã‚Šç·šã¯æ­£ç¢ºã«ä½œã‚Šã¾ã—ã‚‡ã†',
                'âœ‹ æŒ‡ã§ã—ã£ã‹ã‚Šã¨æŠ¼ã•ãˆã¦æŠ˜ã‚Šã¾ã—ã‚‡ã†',
                'ğŸ“ è§’ã‚’åˆã‚ã›ã¦ä¸å¯§ã«æŠ˜ã‚Šã¾ã—ã‚‡ã†',
                'ğŸ”„ æ‰‹é †ã‚’é †ç•ªé€šã‚Šã«é€²ã‚ã¾ã—ã‚‡ã†',
                'ğŸ¯ æœ€çµ‚å½¢çŠ¶ã‚’æ„è­˜ã—ã¦æŠ˜ã‚Šã¾ã—ã‚‡ã†'
            ];
            
            const randomGuide = guides[Math.floor(Math.random() * guides.length)];
            alert(`æŠ˜ã‚Šç´™ã®ã‚³ãƒ„:\n${randomGuide}`);
        }

        function resetOrigami() {
            if (confirm('ç¾åœ¨ã®ä½œå“ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿé€²è¡ŒçŠ¶æ³ãŒå¤±ã‚ã‚Œã¾ã™ã€‚')) {
                gameState.currentStep = 0;
                gameState.foldingSteps = [];
                
                displayWork();
                drawOrigami();
                setupStepButtons();
                updateDisplay();
            }
        }

        function newOrigamiWork() {
            if (confirm('æ–°ã—ã„ä½œå“ã‚’å§‹ã‚ã¾ã™ã‹ï¼Ÿç¾åœ¨ã®é€²è¡ŒçŠ¶æ³ãŒå¤±ã‚ã‚Œã¾ã™ã€‚')) {
                generateNewWork();
            }
        }

        function updateDisplay() {
            document.getElementById('currentWork').textContent = Math.min(gameState.currentWork, gameState.totalWorks);
            document.getElementById('completedWorks').textContent = gameState.completedWorks;
            document.getElementById('score').textContent = gameState.score;
            
            const completionRate = gameState.currentWork > 1 ? 
                ((gameState.completedWorks / (gameState.currentWork - 1)) * 100).toFixed(1) : 0;
            document.getElementById('completionRate').textContent = `${completionRate}%`;
            
            const progress = ((gameState.currentWork - 1) / gameState.totalWorks) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
            
            // ã‚²ãƒ¼ãƒ çµ‚äº†ãƒã‚§ãƒƒã‚¯
            if (gameState.currentWork > gameState.totalWorks) {
                setTimeout(endGame, 1000);
            }
        }

        function endGame() {
            const completionRate = ((gameState.completedWorks / gameState.totalWorks) * 100).toFixed(1);
            const passed = completionRate >= 90;
            
            let message = `ğŸŠ æŠ˜ã‚Šç´™ãƒ‘ã‚ºãƒ«ã‚²ãƒ¼ãƒ å®Œäº†ï¼\n\n`;
            message += `å®Œæˆä½œå“: ${gameState.completedWorks} / ${gameState.totalWorks}\n`;
            message += `å®Œæˆç‡: ${completionRate}%\n`;
            message += `æœ€çµ‚ã‚¹ã‚³ã‚¢: ${gameState.score}ç‚¹\n\n`;
            
            if (passed) {
                message += `ğŸ† ã‚¯ãƒªã‚¢é”æˆï¼\nå„ªç§€ãªç²¾å¯†ä½œæ¥­èƒ½åŠ›ã§ã™ï¼`;
            } else {
                message += `ğŸ“š ã‚‚ã†å°‘ã—é ‘å¼µã‚Šã¾ã—ã‚‡ã†ã€‚\n90%ä»¥ä¸Šã®å®Œæˆç‡ã‚’ç›®æŒ‡ã—ã¦ãã ã•ã„ã€‚`;
            }
            
            alert(message);
            
            if (confirm('ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                initializeGame();
            }
        }

        function goBack() {
            window.location.href = '../index.html';
        }

        // ã‚²ãƒ¼ãƒ åˆæœŸåŒ–
        initializeGame();
    </script>
</body>
</html>