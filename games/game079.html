<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚½ãƒªãƒ†ã‚£ã‚¢ - ã‚²ãƒ¼ãƒ 079</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            padding: 20px;
        }

        .game-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            max-width: 1400px;
            width: 100%;
            text-align: center;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
            max-height: 90vh;
            overflow-y: auto;
        }

        .game-title {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .game-description {
            font-size: 1.1rem;
            margin-bottom: 20px;
            opacity: 0.9;
        }

        .game-stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .stat {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 10px;
            min-width: 120px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .solitaire-board {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            min-height: 500px;
            display: grid;
            grid-template-rows: auto auto 1fr;
            gap: 20px;
        }

        .top-area {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 15px;
        }

        .foundation-area {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .tableau-area {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            min-height: 350px;
        }

        .card-pile {
            background: rgba(255, 255, 255, 0.1);
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 5px;
            position: relative;
        }

        .card-pile.foundation {
            background: rgba(46, 204, 113, 0.2);
            border-color: #2ecc71;
        }

        .card-pile.waste {
            background: rgba(52, 152, 219, 0.2);
            border-color: #3498db;
        }

        .playing-card {
            background: white;
            color: #333;
            border: 1px solid #333;
            border-radius: 6px;
            width: 60px;
            height: 85px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
            font-weight: bold;
            padding: 4px;
            margin-top: -60px;
            position: relative;
        }

        .playing-card:first-child {
            margin-top: 0;
        }

        .playing-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .playing-card.selected {
            border-color: #f1c40f;
            border-width: 3px;
            transform: translateY(-8px);
        }

        .playing-card.red {
            color: #e74c3c;
        }

        .playing-card.black {
            color: #333;
        }

        .playing-card.face-down {
            background: #2c3e50;
            color: white;
            cursor: pointer;
        }

        .card-value {
            font-size: 14px;
            font-weight: bold;
        }

        .card-suit {
            font-size: 18px;
        }

        .card-back {
            background: #2c3e50;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .stock-pile {
            background: rgba(155, 89, 182, 0.2);
            border-color: #9b59b6;
            cursor: pointer;
        }

        .stock-pile:hover {
            background: rgba(155, 89, 182, 0.3);
        }

        .pile-label {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8rem;
            color: #f1c40f;
            font-weight: bold;
        }

        .controls {
            margin: 20px 0;
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn.primary {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
        }

        .btn.warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }

        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .instructions {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
        }

        .instructions h3 {
            color: #f1c40f;
            margin-bottom: 15px;
            text-align: center;
        }

        .instructions ul {
            margin-left: 20px;
        }

        .instructions li {
            margin: 8px 0;
            line-height: 1.4;
        }

        .game-info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }

        @media (max-width: 768px) {
            .solitaire-board {
                padding: 15px;
            }

            .playing-card {
                width: 45px;
                height: 65px;
                font-size: 10px;
                margin-top: -45px;
            }

            .card-suit {
                font-size: 14px;
            }

            .tableau-area {
                grid-template-columns: repeat(7, 1fr);
                gap: 5px;
            }

            .foundation-area {
                gap: 5px;
            }

            .game-container {
                padding: 20px;
            }

            .stat {
                min-width: 100px;
                padding: 8px 15px;
            }
        }
    </style>
</head>
<body>
    <button class="back-btn" onclick="window.location.href = '../index.html'">â† ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>

    <div class="game-container">
        <h1 class="game-title">â™ ï¸ ã‚½ãƒªãƒ†ã‚£ã‚¢</h1>
        <p class="game-description">æˆ¦ç•¥çš„è§£æ³•ã¨è«–ç†çš„æ€è€ƒã«ã‚ˆã‚‹å•é¡Œè§£æ±ºã‚²ãƒ¼ãƒ </p>

        <div class="game-stats">
            <div class="stat">
                <div class="stat-label">å®Œæˆã‚²ãƒ¼ãƒ </div>
                <div class="stat-value" id="completedGames">0/10</div>
            </div>
            <div class="stat">
                <div class="stat-label">å®Œæˆç‡</div>
                <div class="stat-value" id="completionRate">0%</div>
            </div>
            <div class="stat">
                <div class="stat-label">æœ€å°æ‰‹æ•°</div>
                <div class="stat-value" id="bestMoves">--</div>
            </div>
            <div class="stat">
                <div class="stat-label">ã‚„ã‚Šç›´ã—å›æ•°</div>
                <div class="stat-value" id="retryCount">0/3</div>
            </div>
        </div>

        <div class="game-info">
            <div id="gameStatus">æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã—ã¦ãã ã•ã„</div>
        </div>

        <div class="solitaire-board">
            <div class="top-area">
                <div class="card-pile stock-pile" id="stockPile" onclick="drawCard()">
                    <div class="pile-label">å±±æœ­</div>
                    <div class="card-back">ğŸ‚ </div>
                </div>
                
                <div class="card-pile waste" id="wastePile">
                    <div class="pile-label">ã‚ãã‚Šæœ­</div>
                </div>
                
                <div class="foundation-area">
                    <div class="card-pile foundation" id="foundation0">
                        <div class="pile-label">â™ ï¸</div>
                    </div>
                    <div class="card-pile foundation" id="foundation1">
                        <div class="pile-label">â™¥ï¸</div>
                    </div>
                    <div class="card-pile foundation" id="foundation2">
                        <div class="pile-label">â™£ï¸</div>
                    </div>
                    <div class="card-pile foundation" id="foundation3">
                        <div class="pile-label">â™¦ï¸</div>
                    </div>
                </div>
            </div>

            <div class="tableau-area">
                <div class="card-pile" id="tableau0"></div>
                <div class="card-pile" id="tableau1"></div>
                <div class="card-pile" id="tableau2"></div>
                <div class="card-pile" id="tableau3"></div>
                <div class="card-pile" id="tableau4"></div>
                <div class="card-pile" id="tableau5"></div>
                <div class="card-pile" id="tableau6"></div>
            </div>
        </div>

        <div class="controls">
            <button class="btn primary" onclick="newGame()">æ–°ã—ã„ã‚²ãƒ¼ãƒ </button>
            <button class="btn warning" onclick="restartGame()" id="restartBtn" disabled>ã‚„ã‚Šç›´ã—</button>
            <button class="btn" onclick="autoMove()">è‡ªå‹•ç§»å‹•</button>
            <button class="btn" onclick="showHint()">ãƒ’ãƒ³ãƒˆ</button>
        </div>

        <div class="instructions">
            <h3>ğŸ“‹ è©³ç´°ãƒ«ãƒ¼ãƒ«ãƒ»éŠã³æ–¹</h3>
            <ul>
                <li><strong>ç›®çš„:</strong> ã‚¯ãƒ­ãƒ³ãƒ€ã‚¤ã‚¯å½¢å¼ã‚½ãƒªãƒ†ã‚£ã‚¢ã‚’80%ä»¥ä¸Šã®å®Œæˆç‡ã§ã‚¯ãƒªã‚¢ï¼ˆ10ã‚²ãƒ¼ãƒ ä¸­8ã‚²ãƒ¼ãƒ å®Œæˆï¼‰</li>
                <li><strong>åŸºæœ¬ãƒ«ãƒ¼ãƒ«:</strong>
                    <ul>
                        <li>å…¨ã¦ã®ã‚«ãƒ¼ãƒ‰ã‚’4ã¤ã®åŸºç¤æ­ï¼ˆâ™ ï¸â™¥ï¸â™£ï¸â™¦ï¸ï¼‰ã«Aã€œKã®é †ã§ç©ã¿ä¸Šã’ã‚‹</li>
                        <li>å ´æœ­ã§ã¯èµ¤ã¨é»’ãŒäº¤äº’ã«ãªã‚‹ã‚ˆã†ã€å¤§ãã„æ•°ã‹ã‚‰å°ã•ã„æ•°ã®é †ã§ç©ã‚€</li>
                        <li>è¡¨å‘ãã®ã‚«ãƒ¼ãƒ‰ã®ã¿ç§»å‹•å¯èƒ½ã€è£å‘ãã‚«ãƒ¼ãƒ‰ãŒã‚ãã‚ŒãŸã‚‰è¡¨ã«ã™ã‚‹</li>
                    </ul>
                </li>
                <li><strong>æ“ä½œæ–¹æ³•:</strong>
                    <ul>
                        <li>ã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠã€ã‚‚ã†ä¸€åº¦ã‚¯ãƒªãƒƒã‚¯ã§ç§»å‹•å…ˆæ±ºå®š</li>
                        <li>å±±æœ­ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦æ–°ã—ã„ã‚«ãƒ¼ãƒ‰ã‚’ã‚ãã‚‹</li>
                        <li>ç©ºã„ãŸå ´æœ­ã®åˆ—ã«ã¯ã‚­ãƒ³ã‚°ï¼ˆKï¼‰ã®ã¿é…ç½®å¯èƒ½</li>
                        <li>åŸºç¤æ­ã«ã¯Aã‹ã‚‰é †ç•ªã«åŒã˜ã‚¹ãƒ¼ãƒˆã®ã‚«ãƒ¼ãƒ‰ã‚’ç©ã‚€</li>
                    </ul>
                </li>
                <li><strong>æˆ¦ç•¥è¦ç´ :</strong> æœ€å°æ‰‹æ•°ã§ã®å®Œæˆã€æ‰‹é †ã®æœ€é©åŒ–ã€å…ˆèª­ã¿åˆ¤æ–­</li>
                <li><strong>ã‚„ã‚Šç›´ã—:</strong> 3å›ã¾ã§åŒã˜é…ç½®ã§ã®ã‚„ã‚Šç›´ã—å¯èƒ½</li>
                <li><strong>è©•ä¾¡åŸºæº–:</strong> å®Œæˆç‡ã€æ‰‹æ•°åŠ¹ç‡ã€æˆ¦ç•¥çš„æ€è€ƒåŠ›ã€å•é¡Œè§£æ±ºèƒ½åŠ›</li>
                <li><strong>ã‚¯ãƒªã‚¢æ¡ä»¶:</strong> 10ã‚²ãƒ¼ãƒ ä¸­8ã‚²ãƒ¼ãƒ ä»¥ä¸Šå®Œæˆï¼ˆå®Œæˆç‡80%ä»¥ä¸Šï¼‰ã§ã‚½ãƒªãƒ†ã‚£ã‚¢ãƒã‚¹ã‚¿ãƒ¼èªå®š</li>
            </ul>
        </div>
    </div>

    <script>
        let gameState = {
            stock: [],
            waste: [],
            foundations: [[], [], [], []],
            tableau: [[], [], [], [], [], [], []],
            selectedCard: null,
            selectedPile: null,
            moves: 0,
            gamesPlayed: 0,
            gamesCompleted: 0,
            totalGames: 10,
            retryCount: 0,
            maxRetries: 3,
            gameActive: false,
            bestMoves: null
        };

        const suits = ['spades', 'hearts', 'clubs', 'diamonds'];
        const suitSymbols = {'spades': 'â™ ï¸', 'hearts': 'â™¥ï¸', 'clubs': 'â™£ï¸', 'diamonds': 'â™¦ï¸'};
        const values = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];

        function createDeck() {
            const deck = [];
            suits.forEach(suit => {
                values.forEach((value, index) => {
                    deck.push({
                        suit: suit,
                        value: value,
                        rank: index + 1,
                        color: (suit === 'hearts' || suit === 'diamonds') ? 'red' : 'black',
                        faceUp: false
                    });
                });
            });
            return shuffleDeck(deck);
        }

        function shuffleDeck(deck) {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            return deck;
        }

        function dealCards() {
            const deck = createDeck();
            
            // ã‚¿ãƒ–ãƒ­ãƒ¼ã«é…ã‚‹
            let cardIndex = 0;
            for (let col = 0; col < 7; col++) {
                gameState.tableau[col] = [];
                for (let row = 0; row <= col; row++) {
                    const card = deck[cardIndex++];
                    card.faceUp = (row === col); // æœ€å¾Œã®ã‚«ãƒ¼ãƒ‰ã®ã¿è¡¨å‘ã
                    gameState.tableau[col].push(card);
                }
            }
            
            // æ®‹ã‚Šã‚’å±±æœ­ã«
            gameState.stock = deck.slice(cardIndex);
            gameState.waste = [];
            gameState.foundations = [[], [], [], []];
            gameState.moves = 0;
            gameState.selectedCard = null;
            gameState.selectedPile = null;
            gameState.gameActive = true;
            
            updateDisplay();
        }

        function renderCard(card, clickHandler = null) {
            const cardElement = document.createElement('div');
            cardElement.className = `playing-card ${card.color}`;
            
            if (!card.faceUp) {
                cardElement.className += ' face-down';
                cardElement.innerHTML = '<div class="card-back">ğŸ‚ </div>';
            } else {
                cardElement.innerHTML = `
                    <div class="card-value">${card.value}</div>
                    <div class="card-suit">${suitSymbols[card.suit]}</div>
                `;
            }
            
            if (clickHandler) {
                cardElement.onclick = clickHandler;
            }
            
            return cardElement;
        }

        function updateDisplay() {
            // å±±æœ­è¡¨ç¤º
            const stockPile = document.getElementById('stockPile');
            stockPile.innerHTML = '<div class="pile-label">å±±æœ­</div>';
            if (gameState.stock.length > 0) {
                stockPile.appendChild(renderCard({faceUp: false}, drawCard));
            }
            
            // ã‚ãã‚Šæœ­è¡¨ç¤º
            const wastePile = document.getElementById('wastePile');
            wastePile.innerHTML = '<div class="pile-label">ã‚ãã‚Šæœ­</div>';
            if (gameState.waste.length > 0) {
                const topCard = gameState.waste[gameState.waste.length - 1];
                wastePile.appendChild(renderCard(topCard, () => selectCard(topCard, 'waste')));
            }
            
            // åŸºç¤æ­è¡¨ç¤º
            for (let i = 0; i < 4; i++) {
                const foundation = document.getElementById(`foundation${i}`);
                foundation.innerHTML = `<div class="pile-label">${suitSymbols[suits[i]]}</div>`;
                
                if (gameState.foundations[i].length > 0) {
                    const topCard = gameState.foundations[i][gameState.foundations[i].length - 1];
                    foundation.appendChild(renderCard(topCard, () => selectCard(topCard, `foundation${i}`)));
                } else {
                    foundation.onclick = () => moveToFoundation(i);
                }
            }
            
            // ã‚¿ãƒ–ãƒ­ãƒ¼è¡¨ç¤º
            for (let i = 0; i < 7; i++) {
                const tableau = document.getElementById(`tableau${i}`);
                tableau.innerHTML = '';
                
                gameState.tableau[i].forEach((card, index) => {
                    const cardElement = renderCard(card, () => selectCard(card, `tableau${i}`, index));
                    tableau.appendChild(cardElement);
                });
                
                if (gameState.tableau[i].length === 0) {
                    tableau.onclick = () => moveToTableau(i);
                }
            }
            
            updateStats();
            updateButtons();
        }

        function selectCard(card, pileType, cardIndex = null) {
            if (!gameState.gameActive) return;
            
            // é¸æŠè§£é™¤
            document.querySelectorAll('.playing-card').forEach(el => {
                el.classList.remove('selected');
            });
            
            if (gameState.selectedCard === card) {
                gameState.selectedCard = null;
                gameState.selectedPile = null;
                return;
            }
            
            // ç§»å‹•å¯èƒ½ãªã‚«ãƒ¼ãƒ‰ã®ã¿é¸æŠå¯èƒ½
            if (pileType.startsWith('tableau')) {
                const pileIndex = parseInt(pileType.replace('tableau', ''));
                const pile = gameState.tableau[pileIndex];
                if (cardIndex !== pile.length - 1) {
                    // ã‚¿ãƒ–ãƒ­ãƒ¼ã§ã¯ä¸€ç•ªä¸Šã®ã‚«ãƒ¼ãƒ‰ã®ã¿é¸æŠå¯èƒ½
                    return;
                }
            }
            
            if (!card.faceUp) return;
            
            gameState.selectedCard = card;
            gameState.selectedPile = pileType;
            
            // é¸æŠã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
            event.target.classList.add('selected');
        }

        function drawCard() {
            if (gameState.stock.length === 0) {
                // å±±æœ­ãŒç©ºã®å ´åˆã€ã‚ãã‚Šæœ­ã‚’å±±æœ­ã«æˆ»ã™
                gameState.stock = gameState.waste.reverse();
                gameState.stock.forEach(card => card.faceUp = false);
                gameState.waste = [];
            } else {
                // å±±æœ­ã‹ã‚‰ã‚ãã‚Šæœ­ã«
                const card = gameState.stock.pop();
                card.faceUp = true;
                gameState.waste.push(card);
            }
            
            gameState.moves++;
            updateDisplay();
        }

        function moveToFoundation(foundationIndex) {
            if (!gameState.selectedCard) return;
            
            const card = gameState.selectedCard;
            const foundation = gameState.foundations[foundationIndex];
            
            // åŸºç¤æ­ã¸ã®ç§»å‹•å¯èƒ½æ€§ãƒã‚§ãƒƒã‚¯
            if (foundation.length === 0) {
                if (card.rank !== 1) return; // Aã®ã¿
            } else {
                const topCard = foundation[foundation.length - 1];
                if (card.suit !== topCard.suit || card.rank !== topCard.rank + 1) return;
            }
            
            // ã‚«ãƒ¼ãƒ‰ã‚’ç§»å‹•
            removeCardFromPile(gameState.selectedPile);
            foundation.push(card);
            
            gameState.moves++;
            gameState.selectedCard = null;
            gameState.selectedPile = null;
            
            checkForWin();
            updateDisplay();
        }

        function moveToTableau(tableauIndex) {
            if (!gameState.selectedCard) return;
            
            const card = gameState.selectedCard;
            const tableau = gameState.tableau[tableauIndex];
            
            // ã‚¿ãƒ–ãƒ­ãƒ¼ã¸ã®ç§»å‹•å¯èƒ½æ€§ãƒã‚§ãƒƒã‚¯
            if (tableau.length === 0) {
                if (card.rank !== 13) return; // Kã®ã¿
            } else {
                const topCard = tableau[tableau.length - 1];
                if (card.color === topCard.color || card.rank !== topCard.rank - 1) return;
            }
            
            // ã‚«ãƒ¼ãƒ‰ã‚’ç§»å‹•
            removeCardFromPile(gameState.selectedPile);
            tableau.push(card);
            
            gameState.moves++;
            gameState.selectedCard = null;
            gameState.selectedPile = null;
            
            updateDisplay();
        }

        function removeCardFromPile(pileType) {
            if (pileType === 'waste') {
                gameState.waste.pop();
            } else if (pileType.startsWith('foundation')) {
                const index = parseInt(pileType.replace('foundation', ''));
                gameState.foundations[index].pop();
            } else if (pileType.startsWith('tableau')) {
                const index = parseInt(pileType.replace('tableau', ''));
                const pile = gameState.tableau[index];
                pile.pop();
                
                // æ–°ã—ã„æœ€ä¸Šä½ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ã«ã™ã‚‹
                if (pile.length > 0 && !pile[pile.length - 1].faceUp) {
                    pile[pile.length - 1].faceUp = true;
                }
            }
        }

        function autoMove() {
            if (!gameState.gameActive) return;
            
            // è‡ªå‹•ã§åŸºç¤æ­ã«ç§»å‹•ã§ãã‚‹ã‚«ãƒ¼ãƒ‰ã‚’æ¢ã™
            let moved = false;
            
            // ã‚¿ãƒ–ãƒ­ãƒ¼ã‹ã‚‰
            for (let i = 0; i < 7; i++) {
                const pile = gameState.tableau[i];
                if (pile.length > 0) {
                    const card = pile[pile.length - 1];
                    if (card.faceUp && canMoveToFoundation(card)) {
                        removeCardFromPile(`tableau${i}`);
                        gameState.foundations[suits.indexOf(card.suit)].push(card);
                        gameState.moves++;
                        moved = true;
                        break;
                    }
                }
            }
            
            // ã‚ãã‚Šæœ­ã‹ã‚‰
            if (!moved && gameState.waste.length > 0) {
                const card = gameState.waste[gameState.waste.length - 1];
                if (canMoveToFoundation(card)) {
                    gameState.waste.pop();
                    gameState.foundations[suits.indexOf(card.suit)].push(card);
                    gameState.moves++;
                    moved = true;
                }
            }
            
            if (moved) {
                checkForWin();
                updateDisplay();
            } else {
                alert('è‡ªå‹•ç§»å‹•ã§ãã‚‹ã‚«ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“');
            }
        }

        function canMoveToFoundation(card) {
            const foundationIndex = suits.indexOf(card.suit);
            const foundation = gameState.foundations[foundationIndex];
            
            if (foundation.length === 0) {
                return card.rank === 1; // A
            } else {
                const topCard = foundation[foundation.length - 1];
                return card.rank === topCard.rank + 1;
            }
        }

        function showHint() {
            if (!gameState.gameActive) return;
            
            let hints = [];
            
            // åŸºç¤æ­ã«ç§»å‹•ã§ãã‚‹ã‚«ãƒ¼ãƒ‰ã‚’æ¢ã™
            for (let i = 0; i < 7; i++) {
                const pile = gameState.tableau[i];
                if (pile.length > 0) {
                    const card = pile[pile.length - 1];
                    if (card.faceUp && canMoveToFoundation(card)) {
                        hints.push(`ã‚¿ãƒ–ãƒ­ãƒ¼${i + 1}ã®${card.value}${suitSymbols[card.suit]}ã‚’åŸºç¤æ­ã«ç§»å‹•ã§ãã¾ã™`);
                    }
                }
            }
            
            if (gameState.waste.length > 0) {
                const card = gameState.waste[gameState.waste.length - 1];
                if (canMoveToFoundation(card)) {
                    hints.push(`ã‚ãã‚Šæœ­ã®${card.value}${suitSymbols[card.suit]}ã‚’åŸºç¤æ­ã«ç§»å‹•ã§ãã¾ã™`);
                }
            }
            
            // å±±æœ­ã‚’ã‚ãã‚‹ææ¡ˆ
            if (hints.length === 0 && gameState.stock.length > 0) {
                hints.push('å±±æœ­ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦æ–°ã—ã„ã‚«ãƒ¼ãƒ‰ã‚’ã‚ãã£ã¦ã¿ã¾ã—ã‚‡ã†');
            }
            
            if (hints.length === 0) {
                hints.push('ç¾åœ¨å®Ÿè¡Œå¯èƒ½ãªæœ€é©ãªæ‰‹ãŒã‚ã‚Šã¾ã›ã‚“ã€‚é…ç½®ã‚’è¦‹ç›´ã—ã¦ã¿ã¾ã—ã‚‡ã†');
            }
            
            alert(`ğŸ’¡ ãƒ’ãƒ³ãƒˆ:\n${hints.join('\n')}`);
        }

        function checkForWin() {
            const totalCards = gameState.foundations.reduce((sum, foundation) => sum + foundation.length, 0);
            
            if (totalCards === 52) {
                gameState.gameActive = false;
                gameState.gamesCompleted++;
                
                if (!gameState.bestMoves || gameState.moves < gameState.bestMoves) {
                    gameState.bestMoves = gameState.moves;
                }
                
                let message = `ğŸ† ã‚½ãƒªãƒ†ã‚£ã‚¢å®Œæˆï¼\n\n`;
                message += `æ‰‹æ•°: ${gameState.moves}æ‰‹\n`;
                message += `å®Œæˆã‚²ãƒ¼ãƒ : ${gameState.gamesCompleted}/${gameState.totalGames}\n`;
                message += `å®Œæˆç‡: ${Math.round((gameState.gamesCompleted / gameState.gamesPlayed) * 100)}%\n\n`;
                
                if (gameState.gamesCompleted >= Math.ceil(gameState.totalGames * 0.8)) {
                    message += `ğŸ¯ ã‚¯ãƒªã‚¢é”æˆï¼ã‚½ãƒªãƒ†ã‚£ã‚¢ãƒã‚¹ã‚¿ãƒ¼èªå®šï¼`;
                } else {
                    message += `ç›®æ¨™: ${Math.ceil(gameState.totalGames * 0.8)}ã‚²ãƒ¼ãƒ å®Œæˆã§80%é”æˆ`;
                }
                
                alert(message);
                
                if (gameState.gamesPlayed < gameState.totalGames) {
                    setTimeout(() => newGame(), 2000);
                }
            }
        }

        function restartGame() {
            if (gameState.retryCount >= gameState.maxRetries) {
                alert(`ã‚„ã‚Šç›´ã—å›æ•°ã®ä¸Šé™(${gameState.maxRetries}å›)ã«é”ã—ã¾ã—ãŸ`);
                return;
            }
            
            gameState.retryCount++;
            dealCards();
            updateStats();
        }

        function updateStats() {
            document.getElementById('completedGames').textContent = `${gameState.gamesCompleted}/${gameState.totalGames}`;
            
            const completionRate = gameState.gamesPlayed > 0 ? 
                Math.round((gameState.gamesCompleted / gameState.gamesPlayed) * 100) : 0;
            document.getElementById('completionRate').textContent = `${completionRate}%`;
            
            document.getElementById('bestMoves').textContent = gameState.bestMoves || '--';
            document.getElementById('retryCount').textContent = `${gameState.retryCount}/${gameState.maxRetries}`;
            
            // ã‚²ãƒ¼ãƒ çŠ¶æ³æ›´æ–°
            let status = '';
            if (!gameState.gameActive && gameState.gamesPlayed === 0) {
                status = 'æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã—ã¦ãã ã•ã„';
            } else if (gameState.gameActive) {
                status = `ã‚²ãƒ¼ãƒ é€²è¡Œä¸­ - æ‰‹æ•°: ${gameState.moves}`;
            } else {
                status = `ã‚²ãƒ¼ãƒ ${gameState.gamesPlayed}å®Œäº† - æ¬¡ã®ã‚²ãƒ¼ãƒ ã¸`;
            }
            
            document.getElementById('gameStatus').textContent = status;
        }

        function updateButtons() {
            const restartBtn = document.getElementById('restartBtn');
            restartBtn.disabled = !gameState.gameActive || gameState.retryCount >= gameState.maxRetries;
        }

        function newGame() {
            gameState.gamesPlayed++;
            gameState.retryCount = 0;
            dealCards();
        }

        // ã‚²ãƒ¼ãƒ åˆæœŸåŒ–
        updateStats();
    </script>
</body>
</html>